/**
 * Copyright 2021 Sebastian Stubenvoll
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 *
 * ------------------
 *
 * For the respective dependency licenses see here: https://github.com/sebastian-stubenvoll/themostplaylist/blob/main/public/build/DEPENDENCIES
 */

var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function o(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function u(t,n,r){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function s(e,t){e.appendChild(t)}function a(e,t,n){e.insertBefore(t,n||null)}function c(e){e.parentNode.removeChild(e)}function l(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function f(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function p(){return h(" ")}function d(){return h("")}function y(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function m(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function v(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function g(e,t){e.value=null==t?"":t}let b;function _(e){b=e}function k(){if(!b)throw new Error("Function called outside component initialization");return b}const w=[],x=[],E=[],S=[],T=Promise.resolve();let C=!1;function O(e){E.push(e)}const j=new Set;let q=0;function I(){const e=b;do{for(;q<w.length;){const e=w[q];q++,_(e),A(e.$$)}for(_(null),w.length=0,q=0;x.length;)x.pop()();for(let e=0;e<E.length;e+=1){const t=E[e];j.has(t)||(j.add(t),t())}E.length=0}while(w.length);for(;S.length;)S.pop()();C=!1,j.clear(),_(e)}function A(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(O)}}const N=new Set;let R;function Q(){R={r:0,c:[],p:R}}function D(){R.r||r(R.c),R=R.p}function L(e,t){e&&e.i&&(N.delete(e),e.i(t))}function V(e,t,n,r){if(e&&e.o){if(N.has(e))return;N.add(e),R.c.push((()=>{N.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}function B(e,t){const n=t.token={};function r(e,r,o,i){if(t.token!==n)return;t.resolved=i;let u=t.ctx;void 0!==o&&(u=u.slice(),u[o]=i);const s=e&&(t.current=e)(u);let a=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(Q(),V(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),D())})):t.block.d(1),s.c(),L(s,1),s.m(t.mount(),t.anchor),a=!0),t.block=s,t.blocks&&(t.blocks[r]=s),a&&I()}if((o=e)&&"object"==typeof o&&"function"==typeof o.then){const n=k();if(e.then((e=>{_(n),r(t.then,1,t.value,e),_(null)}),(e=>{if(_(n),r(t.catch,2,t.error,e),_(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}var o}function $(e,t,n){const r=t.slice(),{resolved:o}=e;e.current===e.then&&(r[e.value]=o),e.current===e.catch&&(r[e.error]=o),e.block.p(r,n)}function W(e){e&&e.c()}function P(e,n,i,u){const{fragment:s,on_mount:a,on_destroy:c,after_update:l}=e.$$;s&&s.m(n,i),u||O((()=>{const n=a.map(t).filter(o);c?c.push(...n):r(n),e.$$.on_mount=[]})),l.forEach(O)}function U(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function M(e,t){-1===e.$$.dirty[0]&&(w.push(e),C||(C=!0,T.then(I)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function F(t,o,i,u,s,a,l,f=[-1]){const h=b;_(t);const p=t.$$={fragment:null,ctx:null,props:a,update:e,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(h?h.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:o.target||h.$$.root};l&&l(p.root);let d=!1;if(p.ctx=i?i(t,o.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&s(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),d&&M(t,e)),n})):[],p.update(),d=!0,r(p.before_update),p.fragment=!!u&&u(p.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);p.fragment&&p.fragment.l(e),e.forEach(c)}else p.fragment&&p.fragment.c();o.intro&&L(t.$$.fragment),P(t,o.target,o.anchor,o.customElement),I()}_(h)}class G{$destroy(){U(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function J(e){return("0"+e.toString(16)).substr(-2)}function K(){const e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,J).join("")}async function z(e){const t=await function(e){const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",t)}(e);var n;return n=t,btoa(String.fromCharCode.apply(null,new Uint8Array(n))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const H="ab156e4d98604abda38d1a083b70823f",Y="https://sebastian-stubenvoll.github.io/themostplaylist",X=[];function Z(t,n=e){let r;const o=new Set;function u(e){if(i(t,e)&&(t=e,r)){const e=!X.length;for(const e of o)e[1](),X.push(e,t);if(e){for(let e=0;e<X.length;e+=2)X[e][0](X[e+1]);X.length=0}}}return{set:u,update:function(e){u(e(t))},subscribe:function(i,s=e){const a=[i,s];return o.add(a),1===o.size&&(r=n(u)||e),i(t),()=>{o.delete(a),0===o.size&&(r(),r=null)}}}}const ee=Z(0),te=Z(1);let ne,re,oe,ie;async function ue(){const e="client_id="+H,t="redirect_uri="+encodeURIComponent(Y),n=K();localStorage.setItem("state",n);const r="state="+n;return"https://accounts.spotify.com/authorize?"+[e,"response_type=code",t,await async function(e){return"code_challenge="+await z(e)}(function(){const e=K();return localStorage.setItem("verifier",e),e}()),"code_challenge_method=S256",r,"scope=playlist-read-private%20playlist-read-collaborative%20playlist-modify-private"].join("&")}const se=async function(){clearInterval(ie),console.log("Refreshing access token...");let e=[];const t={grant_type:"refresh_token",refresh_token:re,client_id:H};for(let n in t){const r=encodeURIComponent(n),o=encodeURIComponent(t[n]);e.push(r+"="+o)}e=e.join("&");const n=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}),r=await n.json();ne=r.access_token,re=r.refresh_token,oe=1e3*r.expires_in,ie=setInterval(se,oe-.1*oe)};function ae(e){return{Authorization:"Bearer "+e}}async function ce(e,t){const n=await async function(e,t){let n=!0,r=[],o="https://api.spotify.com/v1/search?q="+encodeURIComponent(t)+"&type=playlist&limit=50";for(;n;){const t=await fetch(o,{method:"GET",headers:ae(e)}),i=await t.json();for(let e of i.playlists.items)if(e.name.startsWith("This is")||r.push(e),null==i.playlists.next||100==r.length){n=!1;break}if(null==i.playlists.next||100==r.length){n=!1;break}o=i.playlists.next}return te.set(r.length),r}(e,t),r=await Promise.all(n.map((async t=>{const n={market:"from_token",limit:"100",fields:"items(is_local,track(duration_ms,external_urls,name,popularity,id),added_at,added_by(id,external_urls,href),track.album(external_urls,name),track.artists(external_urls,name)),limit,next,offset"};let r,o=[],i=!0,u=new URL("https://api.spotify.com/v1/playlists/"+t.id),s={market:"from_token",limit:"100",fields:"name,id,external_urls,tracks.items(is_local,track(duration_ms,external_urls,name,popularity,id),added_at,added_by(id,external_urls,href),track.album(external_urls,name),track.artists(external_urls,name)),tracks(limit,next,offset)"};u.search=new URLSearchParams(s).toString();let a={};for(;i;){const c=await fetch(u,{method:"GET",headers:ae(e)});let l=await c.json();null!=r&&(r.tracks.items=l.items,r.tracks.next=l.next,l=r);try{for(let e of l.tracks.items)try{let n=[];for(let t of e.track.artists)n.push({name:t.name,link:t.external_urls.spotify});e.track.id in a||null==e.track.id||(a[e.track.id]={song_title:e.track.name,song_link:e.track.external_urls.spotify,song_popularity:e.track.popularity,song_islocal:e.is_local,song_id:e.track.id,song_duration:e.track.duration_ms,album_name:e.track.album.name,album_link:e.track.album.external_urls.spotify,playlists:[],artists:n,occurrences:1}),o.includes(e.track.id)||(a[e.track.id].playlists.push(t),o.push(e.track.id))}catch{}}catch{}null!=l.tracks.next?(u=new URL(l.tracks.next),r=l,s=n):i=!1}return ee.update((e=>e+1)),a})));let o={};for(let e of r)for(let t of Object.keys(e))t in o?o[t].playlists=[...new Set([...o[t].playlists,...e[t].playlists])]:o[t]=e[t],o[t].occurrences=o[t].playlists.length;return o}function le(e,t,n){const r=e.slice();return r[7]=t[n],r}function fe(t){return{c:e,m:e,p:e,d:e}}function he(e){let t;function n(e,t){return 0==e[0]?me:1==e[0]?ye:2==e[0]?de:pe}let r=n(e),o=r(e);return{c(){o.c(),t=d()},m(e,n){o.m(e,n),a(e,t,n)},p(e,i){r===(r=n(e))&&o?o.p(e,i):(o.d(1),o=r(e),o&&(o.c(),o.m(t.parentNode,t)))},d(e){o.d(e),e&&c(t)}}}function pe(t){let n;return{c(){n=f("div")},m(e,t){a(e,n,t)},p:e,d(e){e&&c(n)}}}function de(t){let n,r,o,i,u,l,p;return{c(){n=f("h1"),r=h("all the spotify api calls are done from your browser directly. no data is passed to any third party. only data necessary for the functionality of this website is stored temporarily in your browser. if you have any concerns feel free to take a look at the source code "),o=f("a"),o.innerHTML='<b class="svelte-10g86m7">here</b>',i=h(".\n            "),u=f("button"),u.innerHTML='<b class="svelte-10g86m7">back</b>',m(o,"href","https://github.com/sebastian-stubenvoll/themostplaylist"),m(o,"target","_blank"),m(o,"rel","noopener noreferrer"),m(o,"class","svelte-10g86m7"),m(u,"class","svelte-10g86m7"),m(n,"class","page svelte-10g86m7")},m(e,c){a(e,n,c),s(n,r),s(n,o),s(n,i),s(n,u),l||(p=y(u,"click",t[5]),l=!0)},p:e,d(e){e&&c(n),l=!1,p()}}}function ye(t){let n,r,o,i,u;return{c(){n=f("h1"),r=h("a silly little project that scans your top 100 playlist-search results for a certain prompt and returns the most frequently added songs. in short: you can use this to create your most ___ playlist ever. since this involves making a fair amount of api calls, you may have to bring a little patience. in theory this could be improved by predicting the api call urls but for now this is good enough.\n        "),o=f("button"),o.innerHTML='<b class="svelte-10g86m7">back</b>',m(o,"class","svelte-10g86m7"),m(n,"class","page svelte-10g86m7")},m(e,c){a(e,n,c),s(n,r),s(n,o),i||(u=y(o,"click",t[4]),i=!0)},p:e,d(e){e&&c(n),i=!1,u()}}}function me(e){let t,n=Array(100),r=[];for(let t=0;t<n.length;t+=1)r[t]=ve(le(e,n,t));return{c(){t=f("h1");for(let e=0;e<r.length;e+=1)r[e].c();m(t,"class","svelte-10g86m7")},m(e,n){a(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(3&o){let i;for(n=Array(100),i=0;i<n.length;i+=1){const u=le(e,n,i);r[i]?r[i].p(u,o):(r[i]=ve(u),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(e){e&&c(t),l(r,e)}}}function ve(t){let n,o,i,u,l,d,v,g,b;return{c(){n=f("a"),o=h("login with spotify"),i=p(),u=f("button"),u.textContent="about",l=p(),d=f("button"),d.textContent="privacy",v=h("\n            Â "),m(n,"href",t[6]),m(n,"class","svelte-10g86m7"),m(u,"class","svelte-10g86m7"),m(d,"class","svelte-10g86m7")},m(e,r){a(e,n,r),s(n,o),a(e,i,r),a(e,u,r),a(e,l,r),a(e,d,r),a(e,v,r),g||(b=[y(u,"click",t[2]),y(d,"click",t[3])],g=!0)},p:e,d(e){e&&c(n),e&&c(i),e&&c(u),e&&c(l),e&&c(d),e&&c(v),g=!1,r(b)}}}function ge(t){let n;return{c(){n=f("h1"),m(n,"class","svelte-10g86m7")},m(e,t){a(e,n,t)},p:e,d(e){e&&c(n)}}}function be(t){let n,r={ctx:t,current:null,token:null,hasCatch:!1,pending:ge,then:he,catch:fe,value:6};return B(t[1],r),{c(){n=d(),r.block.c()},m(e,t){a(e,n,t),r.block.m(e,r.anchor=t),r.mount=()=>n.parentNode,r.anchor=n},p(e,[n]){$(r,t=e,n)},i:e,o:e,d(e){e&&c(n),r.block.d(e),r.token=null,r=null}}}function _e(e,t,n){const r=ue();let o=0;return[o,r,()=>n(0,o=1),()=>n(0,o=2),()=>n(0,o=0),()=>n(0,o=0)]}class ke extends G{constructor(e){super(),F(this,e,_e,be,i,{})}}function we(e){var t={exports:{}};return e(t,t.exports),t.exports
/*!
     * @license :jsstore - V4.3.10 - 24/07/2022
     * https://github.com/ujjwalguptaofficial/JsStore
     * Copyright (c) 2022 @Ujjwal Gupta; Licensed MIT
     */}var xe=we((function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}({2:function(e,t,n){n.r(t),n.d(t,"Connection",(function(){return _})),n.d(t,"ERROR_TYPE",(function(){return r})),n.d(t,"WORKER_STATUS",(function(){return o})),n.d(t,"DATA_TYPE",(function(){return i})),n.d(t,"API",(function(){return u})),n.d(t,"EVENT",(function(){return s})),n.d(t,"QUERY_OPTION",(function(){return a})),n.d(t,"IDB_MODE",(function(){return c})),n.d(t,"OCCURENCE",(function(){return l})),n.d(t,"CONNECTION_STATUS",(function(){return f})),n.d(t,"promise",(function(){return d})),n.d(t,"promiseAll",(function(){return k})),n.d(t,"promiseResolve",(function(){return y})),n.d(t,"forObj",(function(){return w}));var r,o,i,u,s,a,c,l,f,h=function(){function e(e,t){this.type=e,this._info=t,this.message=this.getMsg()}return e.prototype.throw=function(){throw this},e.prototype.log=function(e){this.status&&console.log(e)},e.prototype.logError=function(){console.error(this.get())},e.prototype.logWarning=function(){console.warn(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg=function(){return this.type,this.message},e}();!function(e){e.InvalidUpdateColumn="invalid_update_column",e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedDbName="undefined_database_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.EnableSearchOff="enable_search_off",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.WrongDataType="wrong_data_type",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.ConnectionAborted="connection_aborted",e.ConnectionClosed="connection_closed",e.NotObject="not_object",e.InvalidConfig="invalid_config",e.DbBlocked="Db_blocked",e.IndexedDbNotSupported="indexeddb_not_supported",e.NullValueInWhere="null_value_in_where",e.InvalidJoinQuery="invalid_join_query",e.InvalidOrderQuery="invalid_order_query",e.InvalidQuery="invalid_query",e.InvalidGroupQuery="invalid_group_query",e.ImportScriptsFailed="import_scripts_failed",e.MethodNotExist="method_not_exist",e.Unknown="unknown",e.InvalidMiddleware="invalid_middleware"}(r||(r={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(o||(o={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(i||(i={})),function(e){e.InitDb="init_db",e.Get="get",e.Set="set",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.CloseDb="close_db",e.Union="union",e.Intersect="intersect",e.ImportScripts="import_scripts",e.Middleware="middleware"}(u||(u={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled",e.Upgrade="upgrade",e.Create="create",e.Open="open"}(s||(s={})),function(e){e.Where="where",e.Like="like",e.Regex="regex",e.In="in",e.Equal="=",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Max="max",e.Min="min",e.Avg="avg",e.Count="count",e.Sum="sum",e.Or="or",e.Skip="skip",e.Limit="limit",e.And="and",e.IgnoreCase="ignoreCase",e.Then="then"}(a||(a={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(c||(c={})),function(e){e.First="f",e.Last="l",e.Any="a"}(l||(l={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(f||(f={}));var p,d=function(e){return new Promise(e)},y=function(e){return Promise.resolve(e)},m=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},v=function(){function e(e){this._events={},this._ctx=e}return e.prototype.on=function(e,t){return null==this._events[e]&&(this._events[e]=[]),this._events[e].push(t),this},e.prototype.off=function(e,t){if(this._events[e])if(t){var n=this._events[e].indexOf(t);this._events[e].splice(n,1)}else this._events[e]=[]},e.prototype.emit=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this._events[e]||[],i=0,u=o.length,s=[],a=function(){var e=o[i++];if(e){var r=e.call.apply(e,m([t._ctx],n));return r&&r.then?r:Promise.resolve(r)}};return new Promise((function(e){var t=function(){i<u?a().then((function(e){s.push(e),t()})):e(s)};t()}))},e.prototype.destroy=function(){this._events=null,this._ctx=null},e}(),g=function(){function e(e){this.isConOpened_=!1,this.isDbIdle_=!0,this.requestQueue_=[],this.isCodeExecuting_=!1,this.inactivityTimer_=-1e3,this.middlewares=[],this.eventBus_=new v(this),this.whiteListApi_=[u.InitDb,u.OpenDb,u.Get,u.Set,u.ChangeLogStatus,u.Terminate,u.DropDb],this.isWorker=!0,this.logger=new h(null),e?(this.worker_=e,this.worker_.onmessage=this.onMessageFromWorker_.bind(this)):(this.isWorker=!1,this.initQueryManager_())}return Object.defineProperty(e.prototype,"jsstoreWorker",{get:function(){return this.$worker||self.JsStoreWorker},enumerable:!1,configurable:!0}),e.prototype.initQueryManager_=function(){var e=this.jsstoreWorker;e&&(this.queryManager=new e.QueryManager(this.processFinishedQuery_.bind(this)))},e.prototype.onMessageFromWorker_=function(e){this.processFinishedQuery_(e.data)},e.prototype.processFinishedQuery_=function(e){var t=this.requestQueue_.shift();if(t){if(this.logger.log("request "+t.name+" finished"),e.error)t.onError(e.error);else{switch(t.name){case u.OpenDb:case u.InitDb:this.isConOpened_=!0;break;case u.Terminate:this.isConOpened_=!1,!0===this.isWorker&&this.worker_.terminate();case u.DropDb:this.isConOpened_=!1,this.requestQueue_=[],this.isDbIdle_=!0;break;case u.CloseDb:this.requestQueue_.length>0?this.openDb_():(this.isDbIdle_=!0,this.eventBus_.emit(s.RequestQueueEmpty,[]))}t.onSuccess(e.result)}this.isCodeExecuting_=!1,this.executeQry_()}},e.prototype.openDb_=function(){this.prcoessExecutionOfQry_({name:u.OpenDb,query:{name:this.database.name,version:this.database.version},onSuccess:function(){},onError:function(e){console.error(e)}},0)},e.prototype.executeMiddleware_=function(e){var t=this;return d((function(n){var r=0,o=t.middlewares.length-1,i=function(){if(r<=o){var u=t.middlewares[r++](e);u&&u.then||(u=y(u)),u.then((function(e){i()}))}else n()};i()}))},e.prototype.callResultMiddleware=function(e,t){return d((function(n){var r=0,o=e.length-1,i=function(){if(r<=o){var u=e[r++](t);u.then||(u=y(u)),u.then((function(e){t=e,i()}))}else n(t)};i()}))},e.prototype.pushApi=function(e){var t=this;return new Promise((function(n,r){var o=[];e.onResult=function(e){o.push((function(t){return e(t)}))},t.executeMiddleware_(e).then((function(){(e.onSuccess=function(r){t.callResultMiddleware(o,r).then((function(e){n(e)})).catch((function(t){e.onError(t)}))},e.onError=function(e){o=[],r(e)},0===t.requestQueue_.length)&&(t.eventBus_.emit(s.RequestQueueFilled,[]),!([u.CloseDb,u.DropDb,u.OpenDb,u.Terminate].indexOf(e.name)>=0)&&t.isDbIdle_&&t.isConOpened_?t.openDb_():clearTimeout(t.inactivityTimer_));t.prcoessExecutionOfQry_(e)})).catch(r)}))},e.prototype.prcoessExecutionOfQry_=function(e,t){this.isDbIdle_=!1,null!=t?this.requestQueue_.splice(t,0,e):this.requestQueue_.push(e),this.logger.log("request pushed: "+e.name),this.executeQry_()},e.prototype.executeQry_=function(){var e=this,t=this.requestQueue_.length;if(!this.isCodeExecuting_&&t>0){if(!0===this.isConOpened_)return void this.sendRequestToWorker_(this.requestQueue_[0]);var n=this.requestQueue_.findIndex((function(t){return e.whiteListApi_.indexOf(t.name)>=0}));n>=0&&(this.requestQueue_.splice(0,0,this.requestQueue_.splice(n,1)[0]),this.sendRequestToWorker_(this.requestQueue_[0]))}else 0===t&&!1===this.isDbIdle_&&this.isConOpened_&&(this.inactivityTimer_=setTimeout((function(){e.prcoessExecutionOfQry_({name:u.CloseDb,onSuccess:function(){},onError:function(e){console.error(e)}})}),100))},e.prototype.sendRequestToWorker_=function(e){this.isCodeExecuting_=!0,this.logger.log("request executing: "+e.name);var t={name:e.name,query:e.query};!0===this.isWorker?this.worker_.postMessage(t):this.queryManager.run(t)},e}(),b=(p=function(e,t){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},p(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),_=function(e){function t(t){return e.call(this,t)||this}return b(t,e),t.prototype.initDb=function(e){var t=this;return this.database=e,this.pushApi({name:u.InitDb,query:e}).then((function(e){var n,r=e.database;return e.isCreated&&(n=e.oldVersion?t.eventBus_.emit(s.Upgrade,r,e.oldVersion,e.newVersion):t.eventBus_.emit(s.Create,r)),(n||y()).then((function(e){return t.eventBus_.emit(s.Open,r)})).then((function(t){return e.isCreated}))}))},t.prototype.dropDb=function(){return this.pushApi({name:u.DropDb})},t.prototype.select=function(e){return this.pushApi({name:u.Select,query:e})},t.prototype.count=function(e){return this.pushApi({name:u.Count,query:e})},t.prototype.insert=function(e){return this.pushApi({name:u.Insert,query:e})},t.prototype.update=function(e){return this.pushApi({name:u.Update,query:e})},t.prototype.remove=function(e){return this.pushApi({name:u.Remove,query:e})},t.prototype.clear=function(e){return this.pushApi({name:u.Clear,query:e})},Object.defineProperty(t.prototype,"logStatus",{set:function(e){this.logger.status=e,this.pushApi({name:u.ChangeLogStatus,query:e})},enumerable:!1,configurable:!0}),t.prototype.openDb=function(e,t){var n=this;return this.pushApi({name:u.OpenDb,query:{version:t,name:e}}).then((function(e){return n.database=e,e}))},t.prototype.getDbList=function(){return console.warn("Api getDbList is recommended to use for debugging only. Do not use in code."),indexedDB.databases()},t.prototype.get=function(e){return this.pushApi({name:u.Get,query:e})},t.prototype.set=function(e,t){return this.pushApi({name:u.Set,query:{key:e,value:t}})},t.prototype.terminate=function(){return this.pushApi({name:u.Terminate})},t.prototype.transaction=function(e){return this.pushApi({name:u.Transaction,query:e})},t.prototype.on=function(e,t){this.eventBus_.on(e,t)},t.prototype.off=function(e,t){this.eventBus_.off(e,t)},t.prototype.union=function(e){return this.pushApi({name:u.Union,query:e})},t.prototype.intersect=function(e){return this.pushApi({name:u.Intersect,query:e})},t.prototype.addPlugin=function(e,t){return e.setup(this,t)},t.prototype.addMiddleware=function(e,t){return t?this.pushApi({name:u.Middleware,query:e}):(this.middlewares.push(e),Promise.resolve())},t.prototype.importScripts=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.pushApi({name:u.ImportScripts,query:e})},t}(g),k=function(e){return Promise.all(e)},w=function(e,t){for(var n in e)t(n,e[n])}}})})),Ee=xe,Se=we((function(e){e.exports=Ee})),Te=we((function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}({2:function(e,t,n){n.r(t),n.d(t,"QueryManager",(function(){return Ke}));var r,o,i,u,s,a,c,l,f,h=function(e){return Promise.resolve(e)},p=function(e){return new Promise(e)};!function(e){e.InvalidUpdateColumn="invalid_update_column",e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedDbName="undefined_database_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.EnableSearchOff="enable_search_off",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.WrongDataType="wrong_data_type",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.ConnectionAborted="connection_aborted",e.ConnectionClosed="connection_closed",e.NotObject="not_object",e.InvalidConfig="invalid_config",e.DbBlocked="Db_blocked",e.IndexedDbNotSupported="indexeddb_not_supported",e.NullValueInWhere="null_value_in_where",e.InvalidJoinQuery="invalid_join_query",e.InvalidOrderQuery="invalid_order_query",e.InvalidQuery="invalid_query",e.InvalidGroupQuery="invalid_group_query",e.ImportScriptsFailed="import_scripts_failed",e.MethodNotExist="method_not_exist",e.Unknown="unknown",e.InvalidMiddleware="invalid_middleware"}(r||(r={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(o||(o={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(i||(i={})),function(e){e.InitDb="init_db",e.Get="get",e.Set="set",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.CloseDb="close_db",e.Union="union",e.Intersect="intersect",e.ImportScripts="import_scripts",e.Middleware="middleware"}(u||(u={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled",e.Upgrade="upgrade",e.Create="create",e.Open="open"}(s||(s={})),function(e){e.Where="where",e.Like="like",e.Regex="regex",e.In="in",e.Equal="=",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Max="max",e.Min="min",e.Avg="avg",e.Count="count",e.Sum="sum",e.Or="or",e.Skip="skip",e.Limit="limit",e.And="and",e.IgnoreCase="ignoreCase",e.Then="then"}(a||(a={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(c||(c={})),function(e){e.First="f",e.Last="l",e.Any="a"}(l||(l={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(f||(f={}));var d,y=function(){function e(e){this.columns=[],this.autoIncColumnValue={},this.columns=this.setColumn(e.columns),this.name=e.name,this.alter=e.alter||{}}return e.prototype.setColumn=function(e){var t=[],n=function(n){var o=e[n];o.name=n,o.autoIncrement&&(r.autoIncColumnValue[n]=0),o.primaryKey&&(r.primaryKey=n),o.enableSearch=null==o.enableSearch||o.enableSearch;var i=r.columns.indexOf((function(e){return e.name===n}));if(i<0)t.push(o);else{var u=r.columns[i];Object.assign(u,o)}},r=this;for(var o in e)n(o);return t},e}(),m=function(){function e(){}return e.autoIncrementKey=function(e,t){return"JsStore_"+e+"_"+t+"_Value"},e.set=function(t,n,r){r.tx||r.createTransaction([e.tableName]);var o=r.objectStore(e.tableName);return p((function(e,r){var i=o.put({key:t,value:n});i.onsuccess=function(){e()},i.onerror=r}))},e.get=function(t,n){n.tx||n.createTransaction([e.tableName]);var r=n.objectStore(e.tableName);return p((function(e,o){var i=r.get(n.keyRange(t));i.onsuccess=function(){var t=i.result;e(t&&t.value)},i.onerror=o}))},e.remove=function(t,n){n.tx||n.createTransaction([e.tableName]);var r=n.objectStore(e.tableName);return p((function(e,o){var i=r.delete(n.keyRange(t));i.onsuccess=e,i.onerror=o}))},e.tableName="JsStore_Meta",e.dbSchema="JsStore_DbSchema",e}(),v=function(e){this.name=e.name,this.version=e.version||1,e.tables.push({name:m.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=e.tables.map((function(e){return new y(e)}))},g=function(e,t){for(var n in e)t(n,e[n])},b=function(){function e(e,t){this.type=e,this.info_=t,this.message=this.getMsg_()}return e.prototype.log=function(e){this.status&&console.log(e)},e.prototype.throw=function(){throw this.get()},e.prototype.logError=function(){console.error(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg_=function(){var e;switch(this.type){case r.NotArray:e="Supplied value is not an array";break;case r.UndefinedColumn:e="Column is undefined in Where";break;case r.UndefinedValue:e="Value is undefined in Where";break;case r.UndefinedColumnName:e="Column name is undefined '"+this.info_.TableName+"'";break;case r.UndefinedDbName:e="Database name is not supplied";break;case r.UndefinedColumnValue:e="Column value is undefined";break;case r.NoValueSupplied:e="No value is supplied";break;case r.InvalidOp:e="Invalid Op Value '"+this.info_.Op+"'";break;case r.ColumnNotExist:e=this.info_.isOrder?"Column '"+this.info_.column+"' in order query does not exist":"Column '"+this.info_.column+"' does not exist";break;case r.EnableSearchOff:e="Search is turned off for the Column '"+this.info_.column+"'";break;case r.NullValue:e="Null value is not allowed for column '"+this.info_.ColumnName+"'";break;case r.WrongDataType:e="Supplied value for column '"+this.info_.column+"' have wrong data type";break;case r.TableNotExist:e="Table '"+this.info_.tableName+"' does not exist";break;case r.DbNotExist:e="Database with name "+this.info_.dbName+" does not exist";break;case r.NotObject:e="supplied value is not object";break;case r.InvalidOp:e="Invalid Config '"+this.info_.Config+" '";break;case r.DbBlocked:e="database is blocked, cant be deleted right now";break;case r.NullValueInWhere:e="Null/undefined is not allowed in where. Column '"+this.info_.column+"' has null";break;case r.MethodNotExist:e="method '"+this.info_+"' does not exist.";break;case r.IndexedDbNotSupported:e="Browser does not support indexeddb";break;case r.InvalidJoinQuery:case r.InvalidGroupQuery:case r.InvalidOrderQuery:case r.ImportScriptsFailed:e=this.info_;break;case r.InvalidMiddleware:e="No function "+this.info_+" is found.";break;default:this.type||(this.type=r.Unknown),e=this.message}return e},e}(),_=function(){function e(){this.logger=new b(null)}return e.prototype.emptyTx=function(){this.tx&&(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},e.prototype.createTransactionIfNotExist=function(e,t){this.tx||this.createTransaction(e,t)},e.prototype.createTransaction=function(e,t){var n=this;return void 0===t&&(t=c.ReadWrite),this.tx=this.con.transaction(e,t),p((function(e,t){n.tx.oncomplete=e,n.tx.onabort=e,n.tx.onerror=t}))},e.prototype.keyRange=function(e,t){var n;switch(t){case a.Between:n=IDBKeyRange.bound(e.low,e.high,!1,!1);break;case a.GreaterThan:n=IDBKeyRange.lowerBound(e,!0);break;case a.GreaterThanEqualTo:n=IDBKeyRange.lowerBound(e);break;case a.LessThan:n=IDBKeyRange.upperBound(e,!0);break;case a.LessThanEqualTo:n=IDBKeyRange.upperBound(e);break;default:n=IDBKeyRange.only(e)}return n},e.prototype.objectStore=function(e){return this.tx.objectStore(e)},e.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},e.prototype.close=function(){var e=this;return this.con&&this.con.close(),p((function(t){e.con=null,setTimeout(t,100)}))},e.prototype.initDb=function(e){var t,n=this,r=!1,o=e.version;return p((function(i,u){var s=indexedDB.open(e.name,o);s.onsuccess=function(){n.con=s.result,n.con.onversionchange=function(e){e.target.close()},i({isCreated:r,oldVersion:t,newVersion:o})},s.onerror=function(e){console.error("error",e),u(e)},s.onupgradeneeded=function(n){t=n.oldVersion;var i=n.target,u=i.result;r=!0;var s=i.transaction,a=u.objectStoreNames,c=function(e,t){var n=t.name;if(t.enableSearch&&!e.indexNames.contains(n)){var r=t.primaryKey?{unique:!0}:{unique:t.unique};r.multiEntry=t.multiEntry;var o=null==t.keyPath?n:t.keyPath;e.createIndex(n,o,r)}},l=function(e,t,n){var r=t.columns.findIndex((function(e){return e.name===n}));r>=0&&(t.columns.splice(r,1),e.deleteIndex(n))};e.tables.forEach((function(e){if(!a.contains(e.name))return function(e){var t=e.primaryKey?{keyPath:e.primaryKey}:{autoIncrement:!0},n=u.createObjectStore(e.name,t);e.columns.forEach((function(e){c(n,e)}))}(e);for(var n=s.objectStore(e.name),r=t+1;r<=o;r++){var i=e.alter[r];if(i){if(i.add)e.setColumn(i.add).forEach((function(t){c(n,t),e.columns.push(t)}));g(i.drop||{},(function(t){l(n,e,t)})),g(i.modify||{},(function(t,r){var o=r.multiEntry||r.keyPath||r.unique,i=e.columns.find((function(e){return e.name===t})),u=Object.assign(i,r);u.name=t,o&&(l(n,e,t),c(n,u),e.columns.push(u))}))}}}));for(var f=function(t,n){var r=a.item(t);e.tables.findIndex((function(e){return e.name===r}))<0&&u.deleteObjectStore(r)},h=0,p=a.length;h<p;h++)f(h)}}))},e}(),k=function(e){return Promise.all(e)},w=function(e){return Promise.reject(e)},x=function(e){if(e instanceof b)return e.logError(),e.get();var t=void 0;return e.name?(t=new b(e.name)).message=e.message:(t=new b(e.target.error.name)).message=e.target.error.message,t.logError(),t.get()},E=function(){function e(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return Object.defineProperty(e.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),e.prototype.table=function(e){var t=e||this.tableName;return this.db.tables.find((function(e){return e.name===t}))},e.prototype.primaryKey=function(e){return this.table(e).primaryKey},e.prototype.getColumnInfo=function(e,t){return this.table(t).columns.find((function(t){return t.name===e}))},e.prototype.onException=function(e,t){return console.error(e),this.util.abortTransaction(),w(function(e,t){return void 0===t&&(t=r.InvalidQuery),e.name=t,x(e)}(e,t))},e}(),S=function(e){if(null==e)return i.Null;var t=typeof e;if("object"===t){if(Array.isArray(e))return i.Array;if(e instanceof Date)return i.DateTime}return t},T=function(e){return null==e||"number"==typeof e&&isNaN(e)},C=function(){function e(e,t){this.table=e,this.autoIncrementValue=t}return e.prototype.checkAndModifyValues=function(e){var t,n=this;this.query=e;var r=e.values,o=[];return r.every((function(r,i){return t=n.checkAndModifyValue(r),e.ignore&&t&&(o.push(i),t=null),!t})),o.forEach((function(e){r.splice(e,1)})),{err:t,values:r}},e.prototype.checkAndModifyValue=function(e){var t,n=this;return this.table.columns.every((function(r){return!(t=n.checkAndModifyColumnValue_(r,e))})),t},e.prototype.checkNotNullAndDataType_=function(e,t){return e.notNull&&T(t[e.name])?this.getError(r.NullValue,{ColumnName:e.name}):e.dataType&&!T(t[e.name])&&S(t[e.name])!==e.dataType?this.getError(r.WrongDataType,{column:e.name}):void 0},e.prototype.checkAndModifyColumnValue_=function(e,t){var n=t[e.name];if(e.autoIncrement?T(n)?t[e.name]=++this.autoIncrementValue[e.name]:S(n)===i.Number&&n>this.autoIncrementValue[e.name]&&(this.autoIncrementValue[e.name]=n):void 0!==e.default&&T(n)&&(t[e.name]=e.default),this.query.validation)return this.checkNotNullAndDataType_(e,t)},e.prototype.getError=function(e,t){return new b(e,t)},e}(),O=function(){function e(e){this.table=e}return e.prototype.check=function(e,t){var n,o=this;return typeof e===i.Object?this.table?this.table.columns.every((function(t){return t.name in e&&(n=o.checkByColumn_(t,e[t.name])),!n})):n=new b(r.TableNotExist,{tableName:t}):n=new b(r.NotObject),n},e.prototype.checkByColumn_=function(e,t){if(!0===e.notNull&&T(t))return new b(r.NullValue,{ColumnName:e.name});var n=S(t),o=null!=t;if(e.dataType&&o&&n!==e.dataType&&"object"!==n)return new b(r.WrongDataType,{column:e.name});if(o&&"object"===n){var i=["+","-","*","/","{push}"];for(var u in t)if(i.indexOf(u)<0&&e.dataType&&n!==e.dataType)return new b(r.WrongDataType,{column:e.name})}},e}(),j=function(){function e(e){this.db=e}return e.prototype.validate=function(e,t){switch(e){case u.Select:case u.Remove:case u.Count:return this.checkSelect(t);case u.Insert:return this.checkInsertQuery(t);case u.Update:return this.checkUpdate(t)}},e.prototype.getTable_=function(e){return this.db.tables.find((function(t){return t.name===e}))},e.prototype.isInsertQryValid=function(e){var t,n=this.getTable_(e.into);if(n)switch(S(e.values)){case i.Array:break;case i.Null:t=new b(r.NoValueSupplied);break;default:t=new b(r.NotArray)}else t=new b(r.TableNotExist,{tableName:e.into});return{table:n,log:t}},e.prototype.checkUpdate=function(e){var t=new O(this.getTable_(e.in)).check(e.set,e.in);if(t)return t;if(null!=e.where){if(t=this.checkForNullInWhere_(e))return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkSelect=function(e){if(!this.getTable_(e.from))return new b(r.TableNotExist,{tableName:e.from});if(e.where){var t=this.checkForNullInWhere_(e);if(t)return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkForNullInWhere_=function(e){for(var t in e.where)if(null==e.where[t])return new b(r.NullValueInWhere,{column:t})},e.prototype.addGreatAndLessToNotOp_=function(e){var t=e.where,n=function(e,t){return t.findIndex((function(t){return null!=e[t][a.NotEqualTo]}))>=0},r=function(e,t){var n;return t.forEach((function(t){null!=(n=e[t])[a.NotEqualTo]&&(e[t][a.GreaterThan]=n[a.NotEqualTo],void 0===e[a.Or]?(e[a.Or]={},e[a.Or][t]={}):void 0===e[a.Or][t]&&(e[a.Or][t]={}),e[a.Or][t][a.LessThan]=n[a.NotEqualTo],delete e[t][a.NotEqualTo])})),e};if(S(t)===i.Object){var o=Object.keys(t);if(n(t,o))if(1===o.length)e.where=r(t,o);else{var u=[];o.forEach((function(e){var n;u.push(r(((n={})[e]=t[e],n),[e]))})),e.where=u}}else{var s=[];t.forEach((function(e){var t=Object.keys(e);n(e,t)&&(e=r(e,t)),s.push(e)})),e.where=s}},e.prototype.checkInsertQuery=function(e){var t=this.isInsertQryValid(e),n=t.table,r=t.log;if(r)return r;if(!e.skipDataCheck){var o=new C(n,n.autoIncColumnValue).checkAndModifyValues(e),i=o.values,u=o.err;return e.values=i,u}},e}(),q=(d=function(e,t){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},d(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),I=function(e){function t(t,n){var r=e.call(this)||this;return r.valuesAffected_=[],null==t.validation&&(t.validation=!0),r.query=t,r.util=n,r.tableName=t.into,r}return q(t,e),t.prototype.execute=function(e){var t=this,n=this.db,r=new j(n).validate(u.Insert,this.query);return r?w(r):e().then((function(e){return t.insertData_(n).then((function(e){return t.query.return?t.valuesAffected_:t.rowAffected}))})).catch((function(e){return t.util.abortTransaction(),w(e)}))},t.prototype.insertData_=function(e){var t,n,r,o=this,i=this.query;return t=i.return?function(e){o.valuesAffected_.push(e)}:function(e){++o.rowAffected},r=i.upsert?"put":"add",n=i.ignore&&!o.isTxQuery?function(e){return o.util.con.transaction(i.into,c.ReadWrite).objectStore(i.into)[r](e)}:(o.isTxQuery||o.util.createTransaction([i.into,m.tableName]),o.objectStore=o.util.objectStore(o.tableName),function(e){return o.objectStore[r](e)}),k(i.values.map((function(e){return p((function(r,o){var u=n(e);u.onerror=function(e){i.ignore?r():o(e)},u.onsuccess=function(){t(e),r()}}))}))).then((function(){m.set(m.dbSchema,e,o.util)}))},t}(E),A=void 0===self.alert&&"undefined"==typeof ServiceWorkerGlobalScope,N=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),!indexedDB)return!1;IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange}catch(e){return!1}return!0}(),R=function(e){return Object.keys(e)},Q=function(e){return Array.isArray(e)},D=function(e){return R(e).length},L=function(e){for(var t in e)return t},V=function(){function e(){}return e.prototype.setCaseAndValue=function(e,t){this.caseQuery_=e,this.setValue(t)},e.prototype.setCaseAndColumn=function(e,t){return this.caseQuery_=e,this.setColumn(t),this},e.prototype.setColumn=function(e){return this.columnName_=e,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},e.prototype.setValue=function(e){return this.value=e,this},e.prototype.evaluate=function(){for(var e=0;e<this.length_;e++)if(!0===this.checkCase_(this.caseColumnQuery_[e]))return this.caseColumnQuery_[e].then;var t=this.caseColumnQuery_[this.length_-1].then;return null==t?this.value[this.columnName_]:t},e.prototype.checkCase_=function(e){var t;for(t in e){switch(t){case a.GreaterThan:if(this.value[this.columnName_]>e[t])return!0;break;case a.Equal:if(this.value[this.columnName_]===e[t])return!0;break;case a.LessThan:if(this.value[this.columnName_]<e[t])return!0;break;case a.GreaterThanEqualTo:if(this.value[this.columnName_]>=e[t])return!0;break;case a.LessThanEqualTo:if(this.value[this.columnName_]<=e[t])return!0;break;case a.NotEqualTo:if(this.value[this.columnName_]!==e[t])return!0;break;case a.Between:if(this.value[this.columnName_]>e[t].low&&this.value[this.columnName_]<e[t].high)return!0}return!1}},e}(),B=function(e){var t,n=this,r=!1;return function(o){(t=o.target.result)?r&&n.results.length!==n.limitRecord?(n.pushResult(t.value),t.continue()):(r=!0,t.advance(n.skipRecord)):e()}},$=function(e){var t,n=this,r=!1;return function(o){(t=o.target.result)?r?(n.pushResult(t.value),t.continue()):(r=!0,t.advance(n.skipRecord)):e()}},W=function(e){var t,n=this;return function(r){(t=r.target.result)?(n.pushResult(t.value),t.continue()):e()}},P=function(e){var t,n=this;return function(r){(t=r.target.result)&&n.results.length!==n.limitRecord?(n.pushResult(t.value),t.continue()):e()}},U=function(e){return e.replace(/\s/g,"")},M=function(e){var t;if(null==this.query.join)t=this.getColumnInfo(e);else{var n=U(e).split(".");e=n[1],t=this.getColumnInfo(e,n[0])}if(null==t){var o=this.results[0][e];if(o)return{dataType:S(o),name:e};throw new b(r.ColumnNotExist,{column:e,isOrder:!0})}return t},F=function(e,t){return t.localeCompare(e)},G=function(e,t){return e.localeCompare(t)},J=function(e,t){return new String(t).localeCompare(e)},K=function(e,t){return new String(e).localeCompare(t)},z=function(e,t){return t-e},H=function(e,t){return e-t},Y=function(e,t){return t.getTime()-e.getTime()},X=function(e,t){return e.getTime()-t.getTime()},Z=function(e,t,n){for(var r in n){this.thenEvaluator.setCaseAndValue(n,e);var o=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(n,t);var u=this.thenEvaluator.setColumn(r).evaluate();return typeof e[o]===i.String?F(e[o],t[u]):z(e[o],t[u])}},ee=function(e,t,n){for(var r in n){this.thenEvaluator.setCaseAndValue(n,e);var o=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(n,t);var u=this.thenEvaluator.setColumn(r).evaluate();return typeof e[o]===i.String?G(e[o],t[u]):H(e[o],t[u])}},te=function(e,t){switch(e.dataType){case i.String:return"asc"===t.type?G:F;case i.Number:return"asc"===t.type?H:z;case i.DateTime:return"asc"===t.type?X:Y;default:return"asc"===t.type?K:J}},ne=function(e){var t,n=this;e.type=re(e.type);var r=e.by;if(null!=r&&typeof r===i.Object)"asc"===e.type?this.results.sort((function(e,t){return ee.call(n,e,t,r)})):this.results.sort((function(e,t){return Z.call(n,e,t,r)}));else{var o=M.call(this,r);if(null!=o){var u=te(o,e);r=o.name,null==e.case?this.results.sort((function(e,t){return u(e[r],t[r])})):(this.thenEvaluator.setCaseAndColumn(((t={})[r]=e.case,t),r),this.results.sort((function(e,t){return u(n.thenEvaluator.setValue(e).evaluate(),n.thenEvaluator.setValue(t).evaluate())})))}}},re=function(e){return null==e?"asc":e.toLowerCase()},oe=function(e){var t=this,n=!1;return function(r){var o=r.target.result;if(o)if(n&&t.results.length!==t.limitRecord){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else n=!0,o.advance(t.skipRecord);else e()}},ie=function(e){var t=this,n=!1;return function(r){var o=r.target.result;if(o)if(n){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else n=!0,o.advance(t.skipRecord);else e()}},ue=function(e){var t=this;return function(n){var r=n.target.result;if(r&&t.results.length!==t.limitRecord){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},se=function(e){var t=this;return function(n){var r=n.target.result;if(r){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},ae=function(e){var t,n,r=e.split("%");switch(r[1]?(t=r[1],n=r.length>2?l.Any:l.Last):(t=r[0],n=l.First),n){case l.First:return new RegExp("^"+t,"i");case l.Last:return new RegExp(t+"$","i");default:return new RegExp(""+t,"i")}},ce=function(e){return"object"===S(e)&&!(e instanceof RegExp)},le=function(e){if(ce(e)){var t={};for(var n in e)t[n]=null!=e[n]&&ce(e[n])?le(e[n]):e[n];return t}return e},fe=function(e,t,n){var r=S(e);if(r!==S(t))return!1;switch(r===i.DateTime&&(e=e.getTime(),t=t.getTime()),n){case a.GreaterThan:return e>t;case a.LessThan:return e<t;case a.LessThanEqualTo:return e<=t;case a.GreaterThanEqualTo:return e>=t;case a.NotEqualTo:return e!==t;default:return e===t}},he=function(){function e(e,t){this.where=le(e),this.checkFlag=t}return e.prototype.remove=function(e){var t=e.pop();delete e.reduce((function(e,t){return e&&e[t]}),this.where)[t]},e.prototype.check=function(e){var t=!0;if(!this.checkFlag)return t;for(var n in this.where){if(!t)return t;var r=this.where[n],o=e[n];if("object"===S(r))for(var i in r){if(!t)return t;switch(i){case a.In:t=this.checkIn(n,o);break;case a.Like:t=this.checkLike_(n,o);break;case a.Regex:t=this.checkRegex(n,o);break;case a.Between:case a.GreaterThan:case a.LessThan:case a.GreaterThanEqualTo:case a.LessThanEqualTo:case a.NotEqualTo:t=this.checkComparisionOp_(n,o,i);break;default:t=!1}}else t=fe(r,o)}return t},e.prototype.checkIn=function(e,t){return null!=this.where[e][a.In].find((function(e){return fe(e,t)}))},e.prototype.checkLike_=function(e,t){return ae(this.where[e][a.Like]).test(t)},e.prototype.checkRegex=function(e,t){return this.where[e][a.Regex].test(t)},e.prototype.checkComparisionOp_=function(e,t,n){var r=this.where[e][n];return n!=a.Between?fe(t,r,n):fe(t,r.low,">=")&&fe(t,r.high,"<=")},e}(),pe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),de=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shouldEvaluateLimitAtEnd=!1,t.shouldEvaluateSkipAtEnd=!1,t}return pe(t,e),t.prototype.goToWhereLogic=function(){var e=this.query,t=L(e.where);if(!this.objectStore.indexNames.contains(t)){var n=this.getColumnInfo(t),o=new b(null==n?r.ColumnNotExist:r.EnableSearchOff,{column:t});return w(o)}var i=e.where[t];if("object"!==S(i)){u=D(e.where)>1;return this.whereCheckerInstance=new he(e.where,u),this.whereCheckerInstance.remove([t]),this.executeWhereLogic(t,i,null,"next")}var u=D(i)>1||D(e.where)>1;this.whereCheckerInstance=new he(e.where,u);var s=L(i);switch(this.whereCheckerInstance.remove([t,s]),s){case a.Like:var c=ae(i[a.Like]);return this.executeRegexLogic(t,c);case a.Regex:return this.executeRegexLogic(t,i[a.Regex]);case a.In:return this.executeInLogic(t,i[a.In]);case a.Between:case a.GreaterThan:case a.LessThan:case a.GreaterThanEqualTo:case a.LessThanEqualTo:return this.executeWhereLogic(t,i,s,"next");case a.Aggregate:break;default:return this.executeWhereLogic(t,i,null,"next")}},t}(E),ye=function(e,t){var n=this;return function(r){var o=r.target.result;if(n.results.length!==n.limitRecord&&o){var i=o.value;n.shouldAddValue(i)&&t(i),o.continue()}else e()}},me=function(e,t){var n=this;return function(r){var o=r.target.result;if(o){var i=o.value;n.shouldAddValue(i)&&t(i),o.continue()}else e()}},ve=function(e){var t=this;return function(n){var r=n.target.result;if(r&&t.results.length!==t.limitRecord){var o=r.value;t.shouldAddValue(o)&&t.pushResult(r.value),r.continue()}else e()}},ge=function(e){var t=this;return function(n){var r=n.target.result;if(r){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},be=function(e,t){var n=this;return function(r){var o=r.target.result;n.results.length!==n.limitRecord&&o?(n.shouldAddValue(o)&&t(o.value),o.continue()):e()}},_e=function(e,t){var n=this;return function(r){var o=r.target.result;o?(n.shouldAddValue(o)&&t(o.value),o.continue()):e()}},ke=function(e){var t=this;return function(n){var r=n.target.result;t.results.length!==t.limitRecord&&r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):e()}},we=function(e){var t=this;return function(n){var r=n.target.result;r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):e()}},xe=function(){return xe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},xe.apply(this,arguments)},Ee=function(){function e(e){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=e}return Object.defineProperty(e.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),e.prototype.getTable=function(e){return this.select.table(e)},e.prototype.executeSelect=function(e){return new Oe(e,this.select.util).execute()},e.prototype.execute=function(){var e=this,t=this.query;this.joinQueryStack_=S(t.join)===i.Object?[t.join]:t.join;for(var n=t.from,r=[n],o=0,u=this.joinQueryStack_.length;o<u;o++){var s=this.joinQueryStack_[o],a=this.getJoinTableInfo_(s.on);s.with===a.table1.table&&(a={table1:a.table2,table2:a.table1});var c=this.checkJoinQuery_(a,s);if(c)return w(c);this.joinQueryStack_[o].joinTableInfo=a,r.push(s.with)}return this.select.isTxQuery||this.select.util.createTransaction(r),this.executeSelect({from:n,where:t.where,case:t.case,flatten:t.flatten}).then((function(t){return e.results=t.map((function(t){var n;return(n={})[e.currentQueryStackIndex_]=t,n})),e.tablesFetched.push(n),e.startExecutingJoinLogic_()}))},e.prototype.onJoinQueryFinished_=function(){var e=this;if(this.results.length>0)try{var t=[],n=Object.keys(this.results[0]).length,o=function(e,t){if(null!=e.as)for(var n in e.as)void 0===t[e.as[n]]&&(t[e.as[n]]=t[n],delete t[n]);return t};this.results.forEach((function(r){for(var i=r[0],u=1;u<n;u++){var s=e.joinQueryStack_[u-1];i=xe(xe({},i),o(s,r[u]))}t.push(i)})),this.select.results=t,this.select.setLimitAndSkipEvaluationAtEnd_(),this.select.query.flatten=null;try{this.select.processOrderBy()}catch(e){return w(new b(r.InvalidOrderQuery,e.message))}try{this.select.processGroupDistinctAggr()}catch(e){return w(new b(r.InvalidGroupQuery,e.message))}}catch(e){return w(new b(r.InvalidJoinQuery,e.message))}},e.prototype.startExecutingJoinLogic_=function(){var e=this,t=this.joinQueryStack_[this.currentQueryStackIndex_];if(!t)return this.onJoinQueryFinished_();try{var n=t.joinTableInfo;return this.executeSelect({from:t.with,where:t.where,case:t.case,flatten:t.flatten}).then((function(r){return e.jointables(t.type,n,r),e.tablesFetched.push(n.table2.table),++e.currentQueryStackIndex_,e.startExecutingJoinLogic_()}))}catch(e){return w(new b(r.InvalidJoinQuery,e.message))}},e.prototype.jointables=function(e,t,n){var r,o,i,u,s=this,a=[],c=t.table1.column,l=t.table2.column,f=this.tablesFetched.indexOf(t.table1.table),h=this.currentQueryStackIndex_+1;if("left"===e)i=0,u={},s.getTable(t.table2.table).columns.forEach((function(e){u[e.name]=null})),s.results.forEach((function(e){r=[],o=1===h?function(t){e[f][c]===t[l]&&r.push(t)}:function(t){var n=e[f];null!=n&&n[c]===t[l]&&r.push(t)},n.forEach(o),0===r.length&&(r=[u]),r.forEach((function(t){a[i]=xe({},e),a[i++][h]=t}))}));else!function(){var e=0;s.results.forEach((function(t){n.forEach((function(n){t[f][c]===n[l]&&(a[e]=xe({},t),a[e++][h]=n)}))}))}();this.results=a},e.prototype.getJoinTableInfo_=function(e){var t=(e=U(e)).split("="),n=t[0].split("."),r=t[1].split(".");return{table1:{table:n[0],column:n[1]},table2:{table:r[0],column:r[1]}}},e.prototype.checkJoinQuery_=function(e,t){var n,o=e.table1,i=e.table2,u=this.getTable(o.table),s=this.getTable(i.table);return t.with!==i.table&&(n=new b(r.InvalidJoinQuery,"on value should contains value of with")),null==u.columns.find((function(e){return e.name===o.column}))?n=new b(r.InvalidJoinQuery,"column "+o.column+" does not exist in table "+o.table):null==s.columns.find((function(e){return e.name===i.column}))&&(n=new b(r.InvalidJoinQuery,"column "+i.column+" does not exist in table "+i.table)),null==t.as&&(t.as={}),u.columns.every((function(e){var u=s.columns.find((function(t){return t.name===e.name&&t.name!==o.column}));return null==u||null!=t.as[u.name]||(n=new b(r.InvalidJoinQuery,"column "+e.name+" exist in both table "+o.table+" & "+i.table),!1)})),n},e}(),Se=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Te=function(){return Te=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Te.apply(this,arguments)},Ce=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},Oe=function(e){function t(t,n){var r=e.call(this)||this;return r.sorted=!1,r.isSubQuery=!1,r.thenEvaluator=new V,r.returnResult_=function(){if(r.results.length>0){if(r.query.flatten){var e=[],t={};r.query.flatten.forEach((function(n){r.results.forEach((function(r,o){r[n].forEach((function(t){var o;e.push(Te(Te({},r),((o={})[n]=t,o)))})),t[o]=!0}))}));var n=0;R(t).forEach((function(e){r.results.splice(Number(e)-n,1),++n})),r.results=r.results.concat(e)}r.processGroupDistinctAggr(),r.processOrderBy(),r.shouldEvaluateSkipAtEnd&&r.results.splice(0,r.query.skip),r.shouldEvaluateLimitAtEnd&&(r.results=r.results.slice(0,r.query.limit))}return r.results},r.query=t,r.util=n,r.tableName=t.from,r.setPushResult(),Q(r.query.where)?(r.isArrayQry=!0,r.setLimitAndSkipEvaluationAtEnd_()):(r.skipRecord=t.skip,r.limitRecord=t.limit),t.order?((Q(t.order)||t.order.case||"object"==typeof t.order.by)&&(t.order.idbSorting=!1),r.setLimitAndSkipEvaluationAtEnd_()):t.groupBy&&r.setLimitAndSkipEvaluationAtEnd_(),r}return Se(t,e),t.prototype.execute=function(e){var t=this;e||(e=function(){return h(null)});try{var n=new j(this.db).validate(u.Select,this.query);return n?w(n):e().then((function(e){return t.initTransaction_(),(null==t.query.join?null!=t.query.where?Q(t.query.where)?t.processWhereArrayQry():t.processWhere_():t.executeWhereUndefinedLogic():t.executeJoinQuery()).then(t.returnResult_.bind(t))}))}catch(e){return this.onException(e)}},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var t,n=this.query.where,r=this.primaryKey(),o=!0,i=[],u=function(){if(t===a.And){!0===o?i=e.results:i.length>0&&(u=[],e.results.forEach((function(e){var t;t=e[r],i.findIndex((function(e){return e[r]===t}))>=0&&u.push(e)})),i=u,u=null)}else i.length>0?(e.results=Ce(Ce([],i),e.results),e.removeDuplicates(),i=e.results):i=e.results;var u;if(o=!1,n.length>0)return e.results=[],s();e.results=i},s=function(){return e.query.where=n.shift(),e.query.where[a.Or]&&1===D(e.query.where)?(t=a.Or,e.query.where=e.query.where[a.Or]):t=a.And,e.processWhere_().then(u)};return s()},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransactionIfNotExist([this.tableName],c.ReadOnly),this.objectStore=this.util.objectStore(this.tableName)},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(t){return e.whereCheckerInstance.check(t)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){if(this.orInfo.results=Ce(Ce([],this.orInfo.results),this.results),!this.query.limit||this.query.limit>this.orInfo.results.length){this.results=[];var e=L(this.orInfo.orQuery);if(null!=e){var t={};return t[e]=this.orInfo.orQuery[e],delete this.orInfo.orQuery[e],this.query.where=t,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var e=this.query.where;this.orInfo={orQuery:e.or,results:[]},delete e.or},t}(de);Oe.prototype.executeInLogic=function(e,t){var n=this,r=this.skipRecord,o=function(e){0===r?n.pushResult(e):--r},i=function(){if(!1===n.shouldEvaluateLimitAtEnd&&!1===n.shouldEvaluateSkipAtEnd){if(n.skipRecord&&n.limitRecord)return ye;if(n.skipRecord)return me;if(n.limitRecord)return ve}return ge}(),u=this.objectStore.index(e);return k(t.map((function(e){return t=e,p((function(e,r){var s=u.openCursor(n.util.keyRange(t));s.onsuccess=i.call(n,e,o),s.onerror=r}));var t})))},Oe.prototype.executeWhereUndefinedLogic=function(){var e,t=this,n=this.query.order;if(n&&!1!==n.idbSorting&&n.by){if(!this.objectStore.indexNames.contains(n.by))return w(new b(r.ColumnNotExist,{column:n.by,isOrder:!0}));var o=n.type&&"desc"===n.type.toLowerCase()?"prev":"next";this.sorted=!0,e=this.objectStore.index(n.by).openCursor(null,o)}else e=this.objectStore.openCursor();var i=function(){if(!1===t.shouldEvaluateLimitAtEnd&&!1===t.shouldEvaluateSkipAtEnd){if(t.skipRecord&&t.limitRecord)return B;if(t.skipRecord)return $;if(t.limitRecord)return P}return W}();return p((function(n,r){e.onerror=r,e.onsuccess=i.call(t,n)}))},Oe.prototype.executeWhereLogic=function(e,t,n,r){var o=this;t=n?t[n]:t;var i=this.objectStore.index(e).openCursor(this.util.keyRange(t,n),r),u=function(){if(!1===o.shouldEvaluateLimitAtEnd&&!1===o.shouldEvaluateSkipAtEnd){if(o.skipRecord&&o.limitRecord)return oe;if(o.skipRecord)return ie;if(o.limitRecord)return ue}return se}();return p((function(e,t){i.onerror=t,i.onsuccess=u.call(o,e)}))},Oe.prototype.executeRegexLogic=function(e,t){var n=this,r=this.skipRecord,o=function(e){0===r?n.pushResult(e):--r};this.shouldAddValue=function(e){return t.test(e.key)&&n.whereCheckerInstance.check(e.value)};var i=this.objectStore.index(e).openCursor(),u=function(){if(!1===n.shouldEvaluateLimitAtEnd&&!1===n.shouldEvaluateSkipAtEnd){if(n.skipRecord&&n.limitRecord)return be;if(n.skipRecord)return _e;if(n.limitRecord)return ke}return we}();return p((function(e,t){i.onerror=t,i.onsuccess=u.call(n,e,o)}))},Oe.prototype.setLimitAndSkipEvaluationAtEnd_=function(){this.query.limit&&(this.shouldEvaluateLimitAtEnd=!0),this.query.skip&&(this.shouldEvaluateSkipAtEnd=!0)},Oe.prototype.setPushResult=function(){var e=this;this.query.case?this.pushResult=function(t){var n;for(n in e.thenEvaluator.setCaseAndValue(e.query.case,t),e.query.case)t[n]=e.thenEvaluator.setColumn(n).evaluate();e.results.push(t)}:this.pushResult=function(t){e.results.push(t)}},Oe.prototype.removeDuplicates=function(){var e=this.results;this.results=null;for(var t=this.primaryKey(),n={},r=0,o=e.length;r<o;r++)n[e[r][t]]=e[r];for(var r in e=[],n)e.push(n[r]);this.results=e},Oe.prototype.executeJoinQuery=function(){return new Ee(this).execute()},Oe.prototype.processGroupDistinctAggr=function(){if(this.query.distinct){var e=[],t=this.results[0];for(var n in t)e.push(n);var r=this.primaryKey(),o=e.indexOf(r);e.splice(o,1),this.query.groupBy=e.length>0?e:null}this.query.groupBy?this.query.aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.query.aggregate&&this.processAggregateQry()},Oe.prototype.processOrderBy=function(){var e=this.query.order;if(e&&this.results.length>0&&!this.sorted){var t=S(e);if(t===i.Object)ne.call(this,e);else if(t===i.Array){ne.call(this,e[0]);for(var n=function(t,n){var o=e[t-1].by,i=e[t],u=i.by,s=M.call(r,u);if(null!=s){u=s.name,i.type=re(i.type);var a=te(s,i);r.results.sort((function(e,t){return e[o]===t[o]?a(e[u],t[u]):0}))}},r=this,o=1,u=e.length;o<u;o++)n(o)}}},Oe.prototype.processAggregateQry=function(){var e,t=this.results,n=t.length,r={};this.results=void 0;var o=function(){var n=0;for(var r in t)n+=t[r][e]?1:0;return n},u=function(){var n=0;for(var r in t)n=n>t[r][e]?n:t[r][e];return n},s=function(){var n=1/0,r=1/0;for(var o in t)n=n<(r=t[o][e]?t[o][e]:1/0)?n:r;return n},a=function(){var n=0;for(var r in t)n+=t[r][e];return n},c=function(){var r=0;for(var o in t)r+=t[o][e];return r/n};for(var l in this.query.aggregate){var f=this.query.aggregate[l],h=S(f),p=void 0;switch(l){case"count":p=o;break;case"max":p=u;break;case"min":p=s;break;case"sum":p=a;break;case"avg":p=c}switch(h){case i.String:r[l+"("+(e=f)+")"]=p();break;case i.Array:for(var d in f)r[l+"("+(e=f[d])+")"]=p()}}for(var l in r)t[0][l]=r[l];this.results=[t[0]]},Oe.prototype.executeAggregateGroupBy=function(){var e=this.query.groupBy,t=this.results;this.results=void 0;var n,r,o,u,s={},c=this.query.aggregate,l=function(){var e=function(){return o=(o=s[r])?o["count("+u+")"]:0,o+=t[n][u]?1:0},l=function(){return o=(o=s[r])?o["max("+u+")"]:0,t[n][u]=t[n][u]?t[n][u]:0,o>t[n][u]?o:t[n][u]},f=function(){return o=(o=s[r])?o["min("+u+")"]:1/0,t[n][u]=t[n][u]?t[n][u]:1/0,o<t[n][u]?o:t[n][u]},h=function(){return o=(o=s[r])?o["sum("+u+")"]:0,o+=t[n][u]?t[n][u]:0},p=function(){var e=(o=s[r])?o["sum("+u+")"]:0;e+=t[n][u]?t[n][u]:0,t[n]["sum("+u+")"]=e,o=o?o["count("+u+")"]:0,o+=t[n][u]?1:0,t[n]["count("+u+")"]=o};for(var d in c){var y=c[d],m=S(y),v=void 0;switch(d){case a.Count:v=e;break;case a.Max:v=l;break;case a.Min:v=f;break;case a.Sum:v=h;break;case a.Avg:v=p}switch(m){case i.String:u=y,t[n][d+"("+u+")"]=v();break;case i.Array:for(var g in y)u=y[g],t[n][d+"("+u+")"]=v()}}};if(S(e)===i.String)for(n in t)r=t[n][e],l(),s[r]=t[n];else for(n in t){for(var f in r="",e)r+=t[n][e[f]];l(),s[r]=t[n]}for(var h in t=[],s)t.push(s[h]);if(c.avg)if(S(c.avg)===i.String)for(n in t){var p=t[n]["sum("+c.avg+")"],d=t[n]["count("+c.avg+")"];t[n]["avg("+c.avg+")"]=p/d,c.count!==c.avg&&delete t[n]["count("+c.avg+")"],c.sum!==c.avg&&delete t[n]["sum("+c.avg+")"]}else{var y=S(c.count)===i.String,m=S(c.sum)===i.String;for(n in t)for(var f in c.avg){var v=c.avg[f],g=t[n]["sum("+v+")"],b=t[n]["count("+v+")"];t[n]["avg("+v+")"]=g/b,y&&(c.count!==v||-1===c.count.indexOf(v))&&delete t[n]["count("+v+")"],m&&(c.sum!==v||-1===c.sum.indexOf(v))&&delete t[n]["sum("+v+")"]}}this.results=t},Oe.prototype.processGroupBy=function(){var e=this.query.groupBy,t=this.results,n={};if(this.results=this.query.groupBy=null,S(e)!==i.Object)if(S(e)===i.String)for(var r in t)n[t[r][e]]=t[r];else{var o=void 0;for(var r in t){for(var u in o="",e)o+=t[r][e[u]];n[o]=t[r]}}else if(1===Object.keys(e).length){var s=L(e);for(var r in this.thenEvaluator.setCaseAndColumn(e,s),t)n[this.thenEvaluator.setValue(t[r]).evaluate()]=t[r]}else{o=void 0;for(var r in t){for(var u in o="",this.thenEvaluator.setCaseAndValue(e,t[r]),e)o+=this.thenEvaluator.setColumn(u).evaluate();n[o]=t[r]}}for(var r in t=[],n)t.push(n[r]);this.results=t};var je=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qe=function(e){function t(t,n){var r=e.call(this)||this;return r.resultCount=0,r.query=t,r.util=n,r.tableName=t.from,r}return je(t,e),t.prototype.execute=function(e){var t=this,n=new j(this.db),r=this.query,o=n.validate(u.Count,r);return o?w(o):e().then((function(e){var n;try{var o=function(){var e=new Oe(t.query,t.util);return e.isTxQuery=t.isTxQuery,e.execute().then((function(e){t.resultCount=e.length}))};t.initTransaction_(),n=null==r.join?null!=r.where?r.where.or||Q(t.query.where)?o():t.goToWhereLogic():t.executeWhereUndefinedLogic():o()}catch(e){t.onException(e)}return n.then((function(e){return t.resultCount}))}))},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from],c.ReadOnly),this.objectStore=this.util.objectStore(this.query.from)},t}(de);qe.prototype.executeWhereUndefinedLogic=function(){var e,t,n=this,r=n.objectStore.count?(e=n.objectStore.count(),function(t){return function(){n.resultCount=e.result,t()}}):(e=n.objectStore.openCursor(),function(e){return function(r){(t=r.target.result)?(++n.resultCount,t.continue()):e()}});return p((function(t,n){e.onerror=n,e.onsuccess=r(t)}))},qe.prototype.executeWhereLogic=function(e,t,n){var r,o,i=this;t=n?t[n]:t;var u=1===D(this.query.where);return p((function(s,a){u&&i.objectStore.count?(r=i.objectStore.index(e).count(i.util.keyRange(t,n))).onsuccess=function(){i.resultCount=r.result,s()}:(r=i.objectStore.index(e).openCursor(i.util.keyRange(t,n))).onsuccess=function(e){(o=e.target.result)?(i.whereCheckerInstance.check(o.value)&&++i.resultCount,o.continue()):s()},r.onerror=a}))},qe.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},p((function(e,t){o.onerror=t,o.onsuccess=function(t){(n=t.target.result)?(r.shouldAddValue(n)&&++r.resultCount,n.continue()):e()}}))},qe.prototype.executeInLogic=function(e,t){var n,r=this,o=this.objectStore.index(e),i=1===D(this.query.where);return k(t.map((function(e){return t=e,u=r.util.keyRange(t),i&&r.objectStore.count?p((function(e,t){var n=o.count(u);n.onsuccess=function(t){r.resultCount+=t.target.result,e()},n.onerror=t})):p((function(e,t){var i=o.openCursor(u);i.onsuccess=function(t){(n=t.target.result)?(r.whereCheckerInstance.check(n.value)&&++r.resultCount,n.continue()):e()},i.onerror=t}));var t,u})))};var Ie=function(e){return(Q(e)?e:e.split(".")).reduce((function(e,t){return e&&e[t]}),self)},Ae=function(e,t){var n=e.set,r=e.mapSet;if(r){var o=r(n,t);null!=o&&(n=o)}for(var u in n){var s=n[u];if(S(s)!==i.Object)t[u]=s;else for(var a in s){var c=s[a];switch(a){case"+":t[u]+=c;break;case"-":t[u]-=c;break;case"*":t[u]*=c;break;case"/":t[u]/=c;break;case"{push}":t[u].push(c);break;default:t[u]=s}break}}return t},Ne=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Re=function(e){function t(t,n){var o=e.call(this)||this;o.query=t,o.util=n,o.tableName=t.in;var u=t.mapSet;if(u){var s=S(u)===i.String?Ie(u):u;if(!s)throw new b(r.MethodNotExist,u);t.mapSet=s}return o}return Ne(t,e),t.prototype.execute=function(e){var t=this,n=this.query;try{var r=new j(this.db).validate(u.Update,n);return r?w(r):e().then((function(e){return t.initTransaction(),(null!=n.where?n.where.or||Q(n.where)?t.executeComplexLogic_():t.goToWhereLogic():t.executeWhereUndefinedLogic()).then((function(){return t.rowAffected}))}))}catch(e){return this.onException(e)}},t.prototype.executeComplexLogic_=function(){var e=this,t=this.query,n=new Oe({from:t.in,where:t.where,ignoreCase:t.ignoreCase},this.util);return n.isTxQuery=this.isTxQuery,n.execute().then((function(n){var r,o,i=e.primaryKey(t.in),u=[];n.forEach((function(e){u.push(e[i])})),n=null;var s=((r={})[i]=((o={})[a.In]=u,o),r);return e.query.where=s,e.initTransaction(),e.goToWhereLogic()}))},t.prototype.initTransaction=function(){var e=this.query.in;this.isTxQuery||this.util.createTransaction([e]),this.objectStore=this.util.objectStore(e)},t}(de);Re.prototype.executeWhereUndefinedLogic=function(){var e=this,t=this.objectStore.openCursor();return p((function(n,r){t.onsuccess=function(t){var o=t.target.result;if(o)try{var i=o.update(Ae(e.query,o.value));i.onsuccess=function(){++e.rowAffected,o.continue()},i.onerror=r}catch(e){r(e)}else n()},t.onerror=r}))},Re.prototype.executeWhereLogic=function(e,t,n){var r=this,o=this.query;t=n?t[n]:t;var i=this.objectStore.index(e).openCursor(this.util.keyRange(t,n));return p((function(e,t){i.onsuccess=function(n){var i=n.target.result;if(i)if(r.whereCheckerInstance.check(i.value))try{var u=i.update(Ae(o,i.value));u.onsuccess=function(){++r.rowAffected,i.continue()},u.onerror=t}catch(e){t(e)}else i.continue();else e()},i.onerror=t}))},Re.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},p((function(e,t){o.onsuccess=function(o){if(n=o.target.result)if(r.shouldAddValue(n))try{var i=n.update(Ae(r.query,n.value));i.onsuccess=function(){++r.rowAffected,n.continue()},i.onerror=t}catch(e){t(e)}else n.continue();else e()},o.onerror=t}))},Re.prototype.executeInLogic=function(e,t){var n=this,r=this.objectStore.index(e),o=this.query;return k(t.map((function(e){return t=e,p((function(e,i){var u=r.openCursor(n.util.keyRange(t));u.onsuccess=function(t){var r=t.target.result;if(r){var u=r.value;if(n.whereCheckerInstance.check(u))try{var s=r.update(Ae(o,u));s.onsuccess=function(){++n.rowAffected,r.continue()},s.onerror=i}catch(e){i(e)}else r.continue()}else e()},u.onerror=i}));var t})))};var Qe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),De=function(){return De=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},De.apply(this,arguments)},Le=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r}return Qe(t,e),t.prototype.execute=function(){var e,t,n=this,r=this.query,o=0,i={},u={},s=!0,a=r.queries,c=a.length;if(a.every((function(e,t){return!(t+1<c&&e.from!==a[t+1].from)||(s=!1,!1)})),s){var l=this.primaryKey(a[0].from);e=function(e){return e[l]}}else e=function(e){var t="";for(var n in e)t+=e[n];return t};var f=function(){if(o<c)return(t=new Oe(a[o],n.util)).execute().then((function(t){return i={},t.forEach((function(t){var n=e(t);0===o?u[n]=t:null!=u[n]&&(i[n]=t)})),o>0&&(u=De({},i)),++o,f()}));var s,l=[],h=void 0,p=r.skip,d=r.limit,y=!1,m=function(){l.push(i[s])},v=function(){l.length<d?m():y=!0},g=function(e){0===p?e():--p};if(h=r.skip&&r.limit?function(){g((function(){v()}))}:r.limit?v:r.skip?function(){g((function(){m()}))}:function(){m()},d){for(s in i)if(h(s),y)break}else for(s in i)h(s);return t.results=l,Object.assign(t.query,{order:r.order,join:{}}),t.processOrderBy(),t.processGroupDistinctAggr(),t.results};return f()},t}(E),Ve=function(){function e(){}return e.prototype.execute=function(e){return p((function(t,n){var o=indexedDB.deleteDatabase(e);o.onblocked=function(){var e=new b(r.DbBlocked);return n(x(e))},o.onerror=function(e){return n(x(e))},o.onsuccess=function(){t()}}))},e}(),Be=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$e=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r}return Be(t,e),t.prototype.execute=function(){var e,t=this,n=this.query,r=0,o={},i=!0,u=n.length;if(n.every((function(e,t){return!(t+1<u&&e.from!==n[t+1].from)||(i=!1,!1)})),i){var s=this.primaryKey(n[0].from);e=function(e){return e[s]}}else e=function(e){var t="";for(var n in e)t+=e[n];return t};var a=function(){if(r<n.length)return new Oe(n[r++],t.util).execute().then((function(t){return t.forEach((function(t){o[e(t)]=t})),a()}));var i=[];for(var u in o)i.push(o[u]);return i};return a()},t}(E),We=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pe=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r.tableName=t.from,r}return We(t,e),t.prototype.execute=function(e){var t,n=this,r=new j(this.db),o=this.query,i=r.validate(u.Remove,o);return i?w(i):e().then((function(e){try{n.initTransaction_(),t=null!=o.where?Q(o.where)?n.processWhereArrayQry():n.processWhere_():n.executeWhereUndefinedLogic()}catch(e){return n.onException(e)}return t.then((function(){return n.rowAffected}))}))},t.prototype.processWhereArrayQry=function(){var e=this,t=new Oe(this.query,this.util);return t.isTxQuery=this.isTxQuery,t.execute().then((function(t){var n,r,o=[],i=e.primaryKey(e.query.from);t.forEach((function(e){o.push(e[i])})),t=null;var u=((n={})[i]=((r={})[a.In]=o,r),n);return e.query[a.Where]=u,e.processWhere_()}))},t.prototype.processWhere_=function(){var e=this;return this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var e=this,t=L(this._orInfo.OrQuery);if(null!=t){var n={};return n[t]=this._orInfo.OrQuery[t],delete this._orInfo.OrQuery[t],this.query.where=n,this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))}this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var e=this.query.where;this._orInfo={OrQuery:e.or},delete e.or},t}(de);Pe.prototype.executeInLogic=function(e,t){var n=this,r=this.objectStore.index(e);return k(t.map((function(e){return t=e,p((function(e,o){var i=r.openCursor(n.util.keyRange(t));i.onsuccess=function(t){var r=t.target.result;r?(n.whereCheckerInstance.check(r.value)&&(r.delete(),++n.rowAffected),r.continue()):e()},i.onerror=o}));var t})))},Pe.prototype.executeWhereUndefinedLogic=function(){var e,t=this,n=this.objectStore.openCursor();return p((function(r,o){n.onsuccess=function(n){(e=n.target.result)?(e.delete(),++t.rowAffected,e.continue()):r()},n.onerror=o}))},Pe.prototype.executeWhereLogic=function(e,t,n){var r,o,i=this;return t=n?t[n]:t,o=this.objectStore.index(e).openCursor(this.util.keyRange(t,n)),p((function(e,t){o.onsuccess=function(t){(r=t.target.result)?(i.whereCheckerInstance.check(r.value)&&(r.delete(),++i.rowAffected),r.continue()):e()},o.onerror=t}))},Pe.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},p((function(e,t){o.onsuccess=function(t){(n=t.target.result)?(r.shouldAddValue(n)&&(n.delete(),++r.rowAffected),n.continue()):e()},o.onerror=t}))};var Ue=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Me=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r.tableName=t,r}return Ue(t,e),t.prototype.execute=function(e){var t=this,n=this.query;return this.isTxQuery||this.util.createTransaction([n,m.tableName]),e().then((function(e){var r=t.util.objectStore(n).clear();try{return p((function(e,o){r.onsuccess=function(r){var i=t.table(n);for(var u in i.autoIncColumnValue)i.autoIncColumnValue[u]=0;m.set(m.dbSchema,t.util.db,t.util).then((function(){e()})).catch(o)},r.onerror=o}))}catch(e){return t.onException(e)}}))},t}(E),Fe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ge=function(e){function t(t,n){var r=e.call(this)||this;return r.results={},r.reqQueue=[],r.isQueryExecuting=!1,r.isTxStarted_=!1,r.query=t,r.util=n,r}return Fe(t,e),t.prototype.execute=function(e){var t=this;this.beforeExecute=e;var n=this.validate();return n?w(n):(this.startExecution_(),p((function(e,n){t.onSuccess=e,t.onError=n})).then((function(e){return t.beforeExecute=null,t.log("transaction finished"),e})))},t.prototype.validate=function(){var e=this.query,t=this.notExistingTable_(e.tables);if(t)return new b(r.TableNotExist,{tableName:t});var n=e.method;return Ie(n)?void 0:new b(r.MethodNotExist,n)},t.prototype.startExecution_=function(){var e=this,t=this.query,n=t.method,r=Ie(n);return this.log("transaction query started"),r.call(this,{data:t.data,insert:function(t){return e.pushReq_({name:u.Insert,query:t})},select:function(t){return e.pushReq_({name:u.Select,query:t})},update:function(t){return e.pushReq_({name:u.Update,query:t})},remove:function(t){return e.pushReq_({name:u.Remove,query:t})},count:function(t){return e.pushReq_({name:u.Count,query:t})},setResult:function(t,n){e.results[t]=n},getResult:function(t){return e.results[t]},abort:function(t){e.abortTx_(t)},start:function(){e.startTx_()}})},t.prototype.log=function(e){this.util.logger.log(e)},t.prototype.startTx_=function(){var e=this;try{this.isTxStarted_=!0;var t=this.query.tables;return t=t.concat(m.tableName),this.util.createTransaction(t).then((function(t){e.onSuccess(e.results)})).catch((function(t){e.onError(t)})),this.processExecutionOfQry_()}catch(e){this.onError(this.onException(e))}},t.prototype.onReqFinished_=function(e){var t=this.reqQueue.shift();this.log("finished request : "+t.name+" "),t&&(e.error?(this.abortTx_("automatic abort of transaction due to error occured"),this.log("transaction aborted due to error occured"),this.onError(e.error)):(this.isQueryExecuting=!1,t.onSuccess&&t.onSuccess(e),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(e){this.reqQueue=[],this.util.abortTransaction(),this.log("transaction aborted. Msg : "+e)},t.prototype.executeRequest_=function(e){var t;this.isQueryExecuting=!0,this.log("executing request : "+e.name+" ");var n=this.onReqFinished_.bind(this),r=e.query;switch(e.name){case u.Select:t=new Oe(r,this.util);break;case u.Insert:t=new I(r,this.util);break;case u.Update:t=new Re(r,this.util);break;case u.Remove:t=new Pe(r,this.util);break;case u.Count:t=new qe(r,this.util)}t.isTxQuery=!0,t.execute(this.beforeExecute).then(n).catch((function(e){n({error:e})}))},t.prototype.pushReq_=function(e){var t=this,n=function(){t.reqQueue.push(e)},r=p((function(t,n){e.onSuccess=function(e){t(e)},e.onError=function(e){n(e)}}));return!0===this.isTxStarted_?(n(),this.processExecutionOfQry_()):n(),this.log("request pushed : "+e.name),r},t.prototype.processExecutionOfQry_=function(){!1===this.isQueryExecuting&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(e){var t=this,n=null;return e.every((function(e){return null!=t.table(e)||(n=e,!1)})),n},t}(E),Je=function(e){var t={name:e.name,version:e.version,tables:[]};return e.tables.forEach((function(e){var n={name:e.name,columns:{}};e.columns.forEach((function(e){n.columns[e.name]=e})),t.tables.push(n)})),t},Ke=function(){function e(e){this.middlewares=[],this.util=new _,this.onQryFinished=A?function(e){self.postMessage(e)}:e}return Object.defineProperty(e.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"logger",{get:function(){return this.util.logger},enumerable:!1,configurable:!0}),e.prototype.executeMiddleware_=function(e){var t=this,n=D(this.middlewares)-1;if(n<0)return h();var r={},o=this.db;return Object.defineProperty(r,"database",{get:function(){return Je(o)}}),p((function(o){var i=0,u=function(){if(i<=n){var s=Ie(t.middlewares[i++])(e,r);s&&s.then||(s=Promise.resolve(s)),s.then((function(e){u()}))}else o()};u()}))},e.prototype.executeQuery=function(e,t){var n,o=e.query;switch(e.name){case u.OpenDb:t(),n=this.openDb(o);break;case u.InitDb:t(),n=this.initDb(o);break;case u.CloseDb:t(),n=this.closeDb();break;case u.Insert:n=new I(o,this.util).execute(t);break;case u.Select:n=new Oe(o,this.util).execute(t);break;case u.Count:n=new qe(o,this.util).execute(t);break;case u.Update:n=new Re(o,this.util).execute(t);break;case u.Intersect:t(),n=new Le(o,this.util).execute();break;case u.DropDb:t(),n=this.dropDb();break;case u.Terminate:t(),n=this.terminate();break;case u.Union:t(),n=new $e(o,this.util).execute();break;case u.Remove:n=new Pe(o,this.util).execute(t);break;case u.Clear:n=new Me(o,this.util).execute(t);break;case u.Transaction:n=new Ge(o,this.util).execute(t);break;case u.Get:t(),n=m.get(o,this.util);break;case u.Set:t(),n=m.set(o.key,o.value,this.util);break;case u.ImportScripts:t(),n=this.importScripts_(e);break;case u.ChangeLogStatus:t(),this.logger.status=o,n=Promise.resolve();break;case u.Middleware:return t(),Ie(o)?(this.middlewares.push(o),h()):w(new b(r.InvalidMiddleware,o));default:console.error("The Api:-"+e.name+" does not support."),n=h()}return this.logger.log("Executing query "+e.name+" in web worker"),n},e.prototype.callResultMiddleware=function(e,t){return p((function(n){var r=0,o=D(e)-1,i=function(){if(r<=o){var u=e[r++](t);u instanceof Promise||(u=h(u)),u.then((function(e){t=e,i()}))}else n(t)};i()}))},e.prototype.callBeforeMiddleware=function(e){return p((function(t){var n=0,r=D(e)-1,o=function(){if(n<=r){var i=e[n++]();i instanceof Promise||(i=h(i)),i.then(o)}else t()};o()}))},e.prototype.run=function(e){var t=this,n=[],r=[];e.onResult=function(e){n.push((function(t){return e(t)}))},e.beforeExecute=function(e){r.push((function(t){return e(t)}))},this.executeMiddleware_(e).then((function(o){return t.executeQuery(e,(function(){return t.callBeforeMiddleware(r)})).then((function(e){return t.callResultMiddleware(n,e).then((function(e){t.returnResult_({result:e})}))}))})).catch((function(e){n=[];var r={error:x(e)};t.returnResult_(r)}))},e.prototype.importScripts_=function(e){return p((function(t,n){try{importScripts.apply(void 0,e.query),t()}catch(e){n(new b(r.ImportScriptsFailed,e.message))}}))},e.prototype.returnResult_=function(e){this.logger.log("Query finished inside web worker"),this.util&&this.util.emptyTx(),this.onQryFinished(e)},e.prototype.dropDb=function(){var e=this.db.name;return this.terminate().then((function(){return(new Ve).execute(e)}))},e.prototype.closeDb=function(){return this.util.close()},e.prototype.terminate=function(){var e=this;return this.closeDb().then((function(){e.util.db=null}))},e.prototype.openDb=function(e){var t=this;return this.closeDb().then((function(n){return(t.db&&e.name===t.db.name?t.initDb():t.initDb({name:e.name,tables:[],version:e.version})).then((function(){return t.db}))}))},e.prototype.initDb=function(e){var t=this;if(!N)return w(new b(r.IndexedDbNotSupported));var n=e?new v(e):this.db;return this.util=new _,p((function(e,r){t.util.initDb(n).then((function(r){r.isCreated?m.get(m.dbSchema,t.util).then((function(o){o&&o.tables.forEach((function(e,t){var r=n.tables[t];r&&(r.autoIncColumnValue=e.autoIncColumnValue)})),t.util.db=n,r.database=Je(t.db),m.set(m.dbSchema,n,t.util).then((function(){e(r)}))})):m.get(m.dbSchema,t.util).then((function(n){t.util.db=n,r.database=Je(t.db),e(r)}))})).catch(r)}))},e}();if(A){var ze=new Ke;self.onmessage=function(e){ze.run(e.data)}}}})})),Ce=Te,Oe={setup(e,t){e.$worker=Ce,e.initQueryManager_()}},je=Oe;async function qe(e){await async function(){Ae=new Se.Connection,Ae.addPlugin(je)}(),await async function(){Ne={name:"songs",columns:{song_title:{notNull:!0,dataType:"string"},song_link:{dataType:"string"},song_popularity:{dataType:"number"},song_duration:{dataType:"number"},song_islocal:{dataType:"boolean"},song_id:{primaryKey:!0,notNull:!0,dataType:"string"},album_name:{dataType:"string"},album_link:{dataType:"string"},artists:{notNull:!0,dataType:"array"},playlists:{notNull:!0,dataType:"array"},occurrences:{notNull:"number"}}},Re={name:"pldb",tables:[Ne]},await Ae.initDb(Re)}(),await async function(e){const t=await ce(ne,e);await Ae.insert({into:"songs",values:Object.values(t),upsert:"true"})}(e)}async function Ie(e){return await async function(e){let t={from:"songs",order:{by:"occurrences",type:"desc"},limit:e};const n=await Ae.select(t);return console.log("result"),console.log(n),n}(e)}let Ae,Ne,Re;function Qe(e,t,n){const r=e.slice();return r[3]=t[n],r}function De(e,t,n){const r=e.slice();return r[6]=t[n].name,r[7]=t[n].link,r[9]=n,r}function Le(e){let t,n,r,o,i,u,d,y,g,b,_,k,w,x,E,S=e[0].album_name+"",T=e[0].artists,C=[];for(let t=0;t<T.length;t+=1)C[t]=Ve(De(e,T,t));let O=e[0].playlists,j=[];for(let t=0;t<O.length;t+=1)j[t]=Be(Qe(e,O,t));return{c(){t=f("div"),n=h("by\n            ");for(let e=0;e<C.length;e+=1)C[e].c();r=h("\n            on "),o=f("a"),i=h(S),d=p(),y=f("br"),g=p(),b=f("br"),_=p(),k=f("i"),k.textContent="this song appears in",w=p(),x=f("br"),E=p();for(let e=0;e<j.length;e+=1)j[e].c();m(o,"href",u=e[0].album_link),m(o,"target","_blank"),m(o,"rel","noopener noreferrer"),m(o,"class","svelte-xflp4f"),m(t,"class","svelte-xflp4f")},m(e,u){a(e,t,u),s(t,n);for(let e=0;e<C.length;e+=1)C[e].m(t,null);s(t,r),s(t,o),s(o,i),s(t,d),s(t,y),s(t,g),s(t,b),s(t,_),s(t,k),s(t,w),s(t,x),s(t,E);for(let e=0;e<j.length;e+=1)j[e].m(t,null)},p(e,n){if(1&n){let o;for(T=e[0].artists,o=0;o<T.length;o+=1){const i=De(e,T,o);C[o]?C[o].p(i,n):(C[o]=Ve(i),C[o].c(),C[o].m(t,r))}for(;o<C.length;o+=1)C[o].d(1);C.length=T.length}if(1&n&&S!==(S=e[0].album_name+"")&&v(i,S),1&n&&u!==(u=e[0].album_link)&&m(o,"href",u),1&n){let r;for(O=e[0].playlists,r=0;r<O.length;r+=1){const o=Qe(e,O,r);j[r]?j[r].p(o,n):(j[r]=Be(o),j[r].c(),j[r].m(t,null))}for(;r<j.length;r+=1)j[r].d(1);j.length=O.length}},d(e){e&&c(t),l(C,e),l(j,e)}}}function Ve(e){let t,n,r,o,i=e[6]+"",u=We(e[0].artists,e[9])+"";return{c(){t=f("a"),n=h(i),o=h(u),m(t,"href",r=e[7]),m(t,"target","_blank"),m(t,"class","svelte-xflp4f")},m(e,r){a(e,t,r),s(t,n),a(e,o,r)},p(e,s){1&s&&i!==(i=e[6]+"")&&v(n,i),1&s&&r!==(r=e[7])&&m(t,"href",r),1&s&&u!==(u=We(e[0].artists,e[9])+"")&&v(o,u)},d(e){e&&c(t),e&&c(o)}}}function Be(e){let t,n,r,o,i,u=e[3].name+"";return{c(){t=f("br"),n=p(),r=f("a"),o=h(u),m(r,"href",i=e[3].external_urls.spotify),m(r,"target","_blank"),m(r,"rel","noopener noreferrer"),m(r,"class","svelte-xflp4f")},m(e,i){a(e,t,i),a(e,n,i),a(e,r,i),s(r,o)},p(e,t){1&t&&u!==(u=e[3].name+"")&&v(o,u),1&t&&i!==(i=e[3].external_urls.spotify)&&m(r,"href",i)},d(e){e&&c(t),e&&c(n),e&&c(r)}}}function $e(t){let n,r,o,i,u,l,d,g,b,_,k,w,x,E,S=t[0].song_title+"",T=t[0].occurrences+"",C=t[1]?"-":"+",O=t[1]&&Le(t);return{c(){n=f("main"),r=f("a"),o=h(S),u=h(" in "),l=h(T),d=h(" playlists \n    "),g=f("button"),b=h(C),_=p(),O&&O.c(),k=p(),w=f("br"),m(r,"href",i=t[0].song_link),m(r,"target","_blank"),m(r,"rel","noopener noreferrer"),m(r,"class","svelte-xflp4f"),m(g,"class","svelte-xflp4f"),m(n,"class","svelte-xflp4f")},m(e,i){a(e,n,i),s(n,r),s(r,o),s(n,u),s(n,l),s(n,d),s(n,g),s(g,b),s(n,_),O&&O.m(n,null),s(n,k),s(n,w),x||(E=y(g,"click",t[2]),x=!0)},p(e,[t]){1&t&&S!==(S=e[0].song_title+"")&&v(o,S),1&t&&i!==(i=e[0].song_link)&&m(r,"href",i),1&t&&T!==(T=e[0].occurrences+"")&&v(l,T),2&t&&C!==(C=e[1]?"-":"+")&&v(b,C),e[1]?O?O.p(e,t):(O=Le(e),O.c(),O.m(n,k)):O&&(O.d(1),O=null)},i:e,o:e,d(e){e&&c(n),O&&O.d(),x=!1,E()}}}function We(e,t){return e.length-1==t?"":e.length-2==t?" & ":", "}function Pe(e,t,n){let{r:r}=t,o=!1;return e.$$set=e=>{"r"in e&&n(0,r=e.r)},[r,o,()=>n(1,o=!o)]}class Ue extends G{constructor(e){super(),F(this,e,Pe,$e,i,{r:0})}}function Me(e,t,n){const r=e.slice();return r[12]=t[n],r}function Fe(e){let t,n,r,o,i;function u(e,t){return e[3]||0==e[2].length?Je:Ke}let s=u(e),l=s(e);const f=[He,ze],h=[];function y(e,t){return 0!=e[2].length?0:1}return n=y(e),r=h[n]=f[n](e),{c(){l.c(),t=p(),r.c(),o=d()},m(e,r){l.m(e,r),a(e,t,r),h[n].m(e,r),a(e,o,r),i=!0},p(e,i){s===(s=u(e))&&l?l.p(e,i):(l.d(1),l=s(e),l&&(l.c(),l.m(t.parentNode,t)));let a=n;n=y(e),n===a?h[n].p(e,i):(Q(),V(h[a],1,1,(()=>{h[a]=null})),D(),r=h[n],r?r.p(e,i):(r=h[n]=f[n](e),r.c()),L(r,1),r.m(o.parentNode,o))},i(e){i||(L(r),i=!0)},o(e){V(r),i=!1},d(e){l.d(e),e&&c(t),h[n].d(e),e&&c(o)}}}function Ge(t){let n,r,o,i,u,s=Math.round(t[4]/t[5]*100)+"",l=t[5]==t[4]&&Xe();return{c(){n=f("br"),r=p(),o=h(s),i=h("%\n            "),l&&l.c(),u=d()},m(e,t){a(e,n,t),a(e,r,t),a(e,o,t),a(e,i,t),l&&l.m(e,t),a(e,u,t)},p(e,t){48&t&&s!==(s=Math.round(e[4]/e[5]*100)+"")&&v(o,s),e[5]==e[4]?l||(l=Xe(),l.c(),l.m(u.parentNode,u)):l&&(l.d(1),l=null)},i:e,o:e,d(e){e&&c(n),e&&c(r),e&&c(o),e&&c(i),l&&l.d(e),e&&c(u)}}}function Je(t){let n,r;return{c(){n=f("del"),n.textContent="save playlist.",r=h(" done")},m(e,t){a(e,n,t),a(e,r,t)},p:e,d(e){e&&c(n),e&&c(r)}}}function Ke(t){let n,r,o;return{c(){n=f("button"),n.textContent="save playlist?",m(n,"class","svelte-169v2xx")},m(e,i){a(e,n,i),r||(o=y(n,"click",t[7]),r=!0)},p:e,d(e){e&&c(n),r=!1,o()}}}function ze(t){let n;return{c(){n=h("no playlists found sorry")},m(e,t){a(e,n,t)},p:e,i:e,o:e,d(e){e&&c(n)}}}function He(e){let t,n,r=e[2],o=[];for(let t=0;t<r.length;t+=1)o[t]=Ye(Me(e,r,t));const i=e=>V(o[e],1,1,(()=>{o[e]=null}));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=d()},m(e,r){for(let t=0;t<o.length;t+=1)o[t].m(e,r);a(e,t,r),n=!0},p(e,n){if(4&n){let u;for(r=e[2],u=0;u<r.length;u+=1){const i=Me(e,r,u);o[u]?(o[u].p(i,n),L(o[u],1)):(o[u]=Ye(i),o[u].c(),L(o[u],1),o[u].m(t.parentNode,t))}for(Q(),u=r.length;u<o.length;u+=1)i(u);D()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)L(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)V(o[e]);n=!1},d(e){l(o,e),e&&c(t)}}}function Ye(e){let t,n;return t=new Ue({props:{r:e[12]}}),{c(){W(t.$$.fragment)},m(e,r){P(t,e,r),n=!0},p(e,n){const r={};4&n&&(r.r=e[12]),t.$set(r)},i(e){n||(L(t.$$.fragment,e),n=!0)},o(e){V(t.$$.fragment,e),n=!1},d(e){U(t,e)}}}function Xe(e){let t;return{c(){t=h("sorting results...")},m(e,n){a(e,t,n)},d(e){e&&c(t)}}}function Ze(e){let t,n,o,i,u,l,d,b,_,k,w,x,E,S,T,C=(""==e[0]?"_":e[0])+"";const O=[Ge,Fe],j=[];function q(e,t){return 1==e[1]?0:2==e[1]?1:-1}return~(w=q(e))&&(x=j[w]=O[w](e)),{c(){t=f("main"),n=f("form"),o=f("label"),i=f("input"),u=p(),l=f("button"),d=h("get me the most "),b=h(C),_=h(" playlist ever"),k=p(),x&&x.c(),m(i,"class","svelte-169v2xx"),m(l,"class","svelte-169v2xx"),m(t,"class","svelte-169v2xx")},m(r,c){var f;a(r,t,c),s(t,n),s(n,o),s(o,i),g(i,e[0]),s(n,u),s(n,l),s(l,d),s(l,b),s(l,_),s(t,k),~w&&j[w].m(t,null),E=!0,S||(T=[y(i,"input",e[8]),y(l,"click",e[6]),y(n,"submit",(f=e[9],function(e){return e.preventDefault(),f.call(this,e)}))],S=!0)},p(e,[n]){1&n&&i.value!==e[0]&&g(i,e[0]),(!E||1&n)&&C!==(C=(""==e[0]?"_":e[0])+"")&&v(b,C);let r=w;w=q(e),w===r?~w&&j[w].p(e,n):(x&&(Q(),V(j[r],1,1,(()=>{j[r]=null})),D()),~w?(x=j[w],x?x.p(e,n):(x=j[w]=O[w](e),x.c()),L(x,1),x.m(t,null)):x=null)},i(e){E||(L(x),E=!0)},o(e){V(x),E=!1},d(e){e&&c(t),~w&&j[w].d(),S=!1,r(T)}}}function et(e,t,n){let r,o;u(e,ee,(e=>n(4,r=e))),u(e,te,(e=>n(5,o=e))),history.pushState({},"feed","/themostplaylist");let i,s="heartbreak",a="",c=0,l=!1;async function f(){""!=s&&(ee.set(0),te.set(1),n(1,c=1),n(3,l=!1),indexedDB.deleteDatabase("pldb"),a=s,await qe(s),n(2,i=await Ie(100)),n(1,c=2))}return[s,c,i,l,r,o,()=>f(),()=>{n(3,l=!0),async function(e,t){let n="https://api.spotify.com/v1/me";const r=await fetch(n,{method:"GET",headers:ae(ne)});if(!r.ok)return console.log(r),!1;let o=await r.json();const i=o.id;console.log(i),n="https://api.spotify.com/v1/users/"+i+"/playlists";const u=await fetch(n,{method:"POST",headers:{Authorization:"Bearer "+ne,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:"the most "+t+" playlist",public:!1})});if(!u.ok)return console.log(u),!1;o=await u.json();const s=o.id;let a=[];for(const t of e)a.push("spotify:track:"+t.song_id);n="https://api.spotify.com/v1/playlists/"+s+"/tracks";const c=await fetch(n,{method:"POST",headers:{Authorization:"Bearer "+ne,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({uris:a})});c.ok?o.external_urls.spotify:console.log(c)}(i,a)},function(){s=this.value,n(0,s)},()=>n(0,s)]}class tt extends G{constructor(e){super(),F(this,e,et,Ze,i,{})}}var nt="%[a-f0-9]{2}",rt=new RegExp(nt,"gi"),ot=new RegExp("("+nt+")+","gi");function it(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],it(n),it(r))}function ut(e){try{return decodeURIComponent(e)}catch(r){for(var t=e.match(rt),n=1;n<t.length;n++)t=(e=it(t,n).join("")).match(rt);return e}}var st=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"ï¿½ï¿½","%FF%FE":"ï¿½ï¿½"},n=ot.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var r=ut(n[0]);r!==n[0]&&(t[n[0]]=r)}n=ot.exec(e)}t["%C2"]="ï¿½";for(var o=Object.keys(t),i=0;i<o.length;i++){var u=o[i];e=e.replace(new RegExp(u,"g"),t[u])}return e}(e)}},at=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]},ct=function(e,t){for(var n={},r=Object.keys(e),o=Array.isArray(t),i=0;i<r.length;i++){var u=r[i],s=e[u];(o?-1!==t.indexOf(u):t(u,s,e))&&(n[u]=s)}return n},lt=we((function(e,t){const n=Symbol("encodeFragmentIdentifier");function r(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function o(e,t){return t.encode?t.strict?encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)):encodeURIComponent(e):e}function i(e,t){return t.decode?st(e):e}function u(e){return Array.isArray(e)?e.sort():"object"==typeof e?u(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function s(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function a(e){const t=(e=s(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function c(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function l(e,t){r((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,r)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=n):r[e]=n};case"bracket":return(e,n,r)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"colon-list-separator":return(e,n,r)=>{t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"comma":case"separator":return(t,n,r)=>{const o="string"==typeof n&&n.includes(e.arrayFormatSeparator),u="string"==typeof n&&!o&&i(n,e).includes(e.arrayFormatSeparator);n=u?i(n,e):n;const s=o||u?n.split(e.arrayFormatSeparator).map((t=>i(t,e))):null===n?n:i(n,e);r[t]=s};case"bracket-separator":return(t,n,r)=>{const o=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!o)return void(r[t]=n?i(n,e):n);const u=null===n?[]:n.split(e.arrayFormatSeparator).map((t=>i(t,e)));void 0!==r[t]?r[t]=[].concat(r[t],u):r[t]=u};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const r of e.split("&")){if(""===r)continue;let[e,u]=at(t.decode?r.replace(/\+/g," "):r,"=");u=void 0===u?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?u:i(u,t),n(i(e,t),u,o)}for(const e of Object.keys(o)){const n=o[e];if("object"==typeof n&&null!==n)for(const e of Object.keys(n))n[e]=c(n[e],t);else o[e]=c(n,t)}return!1===t.sort?o:(!0===t.sort?Object.keys(o).sort():Object.keys(o).sort(t.sort)).reduce(((e,t)=>{const n=o[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=u(n):e[t]=n,e}),Object.create(null))}t.extract=a,t.parse=l,t.stringify=(e,t)=>{if(!e)return"";r((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const n=n=>t.skipNull&&null==e[n]||t.skipEmptyString&&""===e[n],i=function(e){switch(e.arrayFormat){case"index":return t=>(n,r)=>{const i=n.length;return void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[o(t,e),"[",i,"]"].join("")]:[...n,[o(t,e),"[",o(i,e),"]=",o(r,e)].join("")]};case"bracket":return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[o(t,e),"[]"].join("")]:[...n,[o(t,e),"[]=",o(r,e)].join("")];case"colon-list-separator":return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[o(t,e),":list="].join("")]:[...n,[o(t,e),":list=",o(r,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return n=>(r,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?r:(i=null===i?"":i,0===r.length?[[o(n,e),t,o(i,e)].join("")]:[[r,o(i,e)].join(e.arrayFormatSeparator)])}default:return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,o(t,e)]:[...n,[o(t,e),"=",o(r,e)].join("")]}}(t),u={};for(const t of Object.keys(e))n(t)||(u[t]=e[t]);const s=Object.keys(u);return!1!==t.sort&&s.sort(t.sort),s.map((n=>{const r=e[n];return void 0===r?"":null===r?o(n,t):Array.isArray(r)?0===r.length&&"bracket-separator"===t.arrayFormat?o(n,t)+"[]":r.reduce(i(n),[]).join("&"):o(n,t)+"="+o(r,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[n,r]=at(e,"#");return Object.assign({url:n.split("?")[0]||"",query:l(a(e),t)},t&&t.parseFragmentIdentifier&&r?{fragmentIdentifier:i(r,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[n]:!0},r);const i=s(e.url).split("?")[0]||"",u=t.extract(e.url),a=t.parse(u,{sort:!1}),c=Object.assign(a,e.query);let l=t.stringify(c,r);l&&(l=`?${l}`);let f=function(e){let t="";const n=e.indexOf("#");return-1!==n&&(t=e.slice(n)),t}(e.url);return e.fragmentIdentifier&&(f=`#${r[n]?o(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${i}${l}${f}`},t.pick=(e,r,o)=>{o=Object.assign({parseFragmentIdentifier:!0,[n]:!1},o);const{url:i,query:u,fragmentIdentifier:s}=t.parseUrl(e,o);return t.stringifyUrl({url:i,query:ct(u,r),fragmentIdentifier:s},o)},t.exclude=(e,n,r)=>{const o=Array.isArray(n)?e=>!n.includes(e):(e,t)=>!n(e,t);return t.pick(e,o,r)}}));function ft(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function ht(e){let t,n,r,o;const i=[dt,pt],u=[];function s(e,t){return e[0]?1:0}return t=s(e),n=u[t]=i[t](e),{c(){n.c(),r=d()},m(e,n){u[t].m(e,n),a(e,r,n),o=!0},p(e,o){let a=t;t=s(e),t!==a&&(Q(),V(u[a],1,1,(()=>{u[a]=null})),D(),n=u[t],n||(n=u[t]=i[t](e),n.c()),L(n,1),n.m(r.parentNode,r))},i(e){o||(L(n),o=!0)},o(e){V(n),o=!1},d(e){u[t].d(e),e&&c(r)}}}function pt(e){let t,n;return t=new tt({}),{c(){W(t.$$.fragment)},m(e,r){P(t,e,r),n=!0},i(e){n||(L(t.$$.fragment,e),n=!0)},o(e){V(t.$$.fragment,e),n=!1},d(e){U(t,e)}}}function dt(e){let t,n;return t=new ke({}),{c(){W(t.$$.fragment)},m(e,r){P(t,e,r),n=!0},i(e){n||(L(t.$$.fragment,e),n=!0)},o(e){V(t.$$.fragment,e),n=!1},d(e){U(t,e)}}}function yt(t){let n;return{c(){n=h("checking spotify access!")},m(e,t){a(e,n,t)},p:e,i:e,o:e,d(e){e&&c(n)}}}function mt(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!1,pending:yt,then:ht,catch:ft,blocks:[,,,]};return B(e[1],r),{c(){t=f("main"),r.block.c()},m(e,o){a(e,t,o),r.block.m(t,r.anchor=null),r.mount=()=>t,r.anchor=null,n=!0},p(t,[n]){$(r,e=t,n)},i(e){n||(L(r.block),n=!0)},o(e){for(let e=0;e<3;e+=1){V(r.blocks[e])}n=!1},d(e){e&&c(t),r.block.d(),r.token=null,r=null}}}function vt(e,t,n){let r;const o=async function(){console.log(1);const e=await async function(){if("undefined"!=typeof window){const e=lt.parse(window.location.search);if(e.code){if(await async function(e){if(e.state!=localStorage.getItem("state"))return!1;{let t=[];const n={client_id:H,grant_type:"authorization_code",code:e.code,redirect_uri:Y,code_verifier:localStorage.getItem("verifier")};for(let e in n){const r=encodeURIComponent(e),o=encodeURIComponent(n[e]);t.push(r+"="+o)}t=t.join("&");const r="https://accounts.spotify.com/api/token",o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});if(200!=o.status)return!1;{const e=await o.json();return ne=e.access_token,re=e.refresh_token,oe=1e3*e.expires_in,localStorage.removeItem("verifier"),ie=setInterval(se,oe-.1*oe),!0}}}(e))return!0}}return!1}();console.log(2),n(0,r=!!e)}();return[r,o]}return new class extends G{constructor(e){super(),F(this,e,vt,mt,i,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
